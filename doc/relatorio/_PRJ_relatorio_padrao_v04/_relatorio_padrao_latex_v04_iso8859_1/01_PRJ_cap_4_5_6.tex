%%________________________________________________________________________
%% LEIM | PROJETO
%% 2022 / 2013 / 2012
%% Modelo para relatório
%% v04: alteração ADEETC para DEETC; outros ajustes
%% v03: correção de gralhas
%% v02: inclui anexo sobre utilização sistema controlo de versões
%% v01: original
%% PTS / MAR.2022 / MAI.2013 / 23.MAI.2012 (construído)
%%________________________________________________________________________


%%________________________________________________________________________
\chapter{Implementação do Modelo}
\label{ch:implementacaoDoModelo}
%%________________________________________________________________________

Este capítulo descreve todo o processo de implementação das etapas enunciadas na secção abordagem (\ref{sec:abordagem}).

%%________________________________________________________________________
\section{Construção do \textit{Dataset}}
\label{sec:construcaodatasetv2}
%%________________________________________________________________________

O processo de criação do \textit{dataset} pode ser representado pelo esquema que se encontra na figura \ref{fig:construcaodatasetdetalhe}. 

%%À exceção da fase de anotação manual das batidas de bola (\aspas{\textit{Human ear annotation}}), todas as outras fases do esquema foram realizadas no ambiente de desenvolvimento \textit{Pycharm} que compila e executa código \textit{Python} \cite{jetbrains_pycharm_2022}.
 
Para simplificar o processo de anotação das batidas de bola (\aspas{\textit{Human ear annotation}}), optou-se por segmentar o vídeo de longa duração em vídeos com 1 minuto. O processo de segmentação deu origem a cerca de 90 vídeos de curta duração. Para cada um desses vídeos, foram gerados os áudios correspondentes e 30 foram anotados.

A anotação das batidas de bola foi realizada com o auxílio da aplicação \textit{Adobe Audition} \cite{adobe2013adobe}. Esta ferramenta permite efetuar uma análise sobre áudio e verificar em que instantes ocorrem batidas de bola. A anotação é realizada num ficheiro \textit{Excel}, que posteriormente é convertido para \textit{CSV}.

Cada evento está registado no ficheiro \textit{Excel} com os seguintes dados:

\begin{itemize}
\item
O tipo de batida de bola (em raquete, no chão, na rede metálica, entre outros). Todos estes tipos pertencem à classe batida de bola, no entato apenas as batidas de bola em raquete foram consideradas neste projeto;

\item
O intervalo de tempo em que ocorre a batida de bola (amostras inicial e final no áudio);

\item
O tipo de ambiente em que o treino é praticado (\textit{indoor} ou \textit{outdoor});

\item
O lado do campo em que batida de bola ocorre.

\end{itemize}

O tipo de ambiente onde o desporto é praticado e o lado do campo onde ocorrem as batidas de bola estão fora do contexto do presente trabalho.

Na fase de extração de características iterou-se apenas sobre os áudios anotados. Sobre estes áudios realizou-se o processo descrito na secção \ref{sec:construcaododataset} para obtenção da matriz de características com o auxílio da biblioteca \textit{tensorflow}. Esta biblioteca permite realizar  indexação e varrimento sobre \textit{arrays} de forma simples.

Na fase de \aspas{\textit{Labeling}} combinou-se a informação registada nos ficheiros \textit{CSV} (batidas de bola) com as características tal como se verifica na figura  \ref{fig:matrizfeaturesv2}, o que permitiu obter o \textit{dataset} a utilizar na contrução do modelo (\aspas{\textit{Input data}}). %Este processo de etiquetação foi realizado com base na equação \ref{eq:formulan}.

\begin{figure}[h]
   \centering
   \includegraphics[width=14cm]{./construct_dataset_scheme}
\caption{Processo detalhado de construção do \textit{dataset}.}
\label{fig:construcaodatasetdetalhe}
\end{figure}

Considerou-se como primeira abordagem a primeira linha da tabela \ref{tab:tabelaparamformuladen}, onde a cada iteração a janela desliza 1024 amostras e abranje 22 grupos de 1024 amostras (0.5 segundos). O \textit{dataset} obtido contém cerca de 75 mil exemplos: 19724 exemplos de batidas de bola e 54646 exemplos de ruído.

%%________________________________________________________________________
\section{Construção do Classificador}
\label{sec:sec:construcaodoclassificadorv2}
%%________________________________________________________________________

A construção do modelo pode ser descrita através da figura \ref{fig:construcaoclassif}, que descreve de uma forma geral as fases envolvidas neste processo. 

\begin{figure}
   \centering
   \includegraphics[width=12cm]{./model_construction_scheme_v4}
\caption{Processo de construção do classificador.}
\label{fig:construcaoclassif}
\end{figure}

\bigskip
\paragraph{\textbf{Escolha do modelo}} \hspace{0pt}

\smallskip
\smallskip
\smallskip
\noindent Através da ferramenta ODM aplicaram-se vários algoritmos ao \textit{dataset} e obtiveram-se os resultados que se encontram na figura \ref{fig:odmresults}. %Antes do processo de treino, à exceção da árvore de decisão, os dados de \textit{input} são pré-processados. No caso da rede neuronal, é utilizado o algoritmo \textit{Standard Scaler} de modo que as dimensões da matriz de características tenham média zero e variância igual a 1 \cite{orange3_2022_neuralnetwork}. 
Estes resultados (independentes das classes) sugerem que os modelos com melhores desemepenhos são o regressor logístico e a rede neuronal. Para estes dois classificadores os valores das métricas de avaliação (\cf, \ref{sec:classifevalidacaocruzada}) estão acima dos 85\% e o erro (\aspas{\textit{LogLoss}}) associado à classificação é igual ou inferior 34\%.

As figuras \ref{fig:odm_results_positives} e \ref{fig:odm_results_negatives} correspondem aos resultados para cada uma das classes (positivos e negativos). Observando separadamente estes resultados, verifica-se que a rede neuronal obtém os melhores resultados em termos de taxa de sucesso, média harmónica e erro associado. Por este motivo, a rede neuronal será a técnica de aprendizagem automática a utilizar para construir o classificador.

%Devido ao desequilíbrio no \textit{dataset}, os valores obtidos no caso da classe dos positivos (batidas de bola) são menos eficientes. Como solução, será aplicada a técnica de sub-amostragem na qual se diminui o número de exemplos da classe dos negativos (ruído).

%%O regressor logístico pode ser \aspas{visto} como uma rede neuronal com apenas uma camada escondida \cite{datasciencecentral_lrnn_2019}. Pelo que neste trabalho será utilizada a rede neuronal como método de aprendizagem automática.

\begin{figure}[h]
   \centering
   \includegraphics[width=11cm]{./odm_results_v2}
\caption{Resultados (independentes das classes) da aplicação de vários algoritmos aos dados.}
\label{fig:odmresults}
\end{figure}

De forma obter resultados próximos dos observados para a rede neuronal serão considerados os hiper-parâmetros utilizados na aplicação ODM.

\paragraph{\textbf{Definição dos Hiper-parâmetros e Treino do Modelo}} \hspace{0pt}

\smallskip
\smallskip
\smallskip
\noindent Para construir e treinar o modelo utilizou-se a biblioteca \textit{Python Keras}. Esta biblioteca usa internamente o módulo \textit{tensorflow} e permite criar modelos de aprendizagem automática de forma simples e flexível \cite{keras_aboutkeras_2022}. 

A capacidade de generalizar do modelo foi verificada através do método de validação cruzada, \textit{Stratified KFold}. Tal como na ferramenta ODM, os dados foram divididos em 5 \textit{folds}.

Os hiper-parâmetros considerados foram os seguintes:

\begin{itemize}
\item
Temporais -- duração da janela de dimensão fixa (\textit{eventLength}) e número de amostras deslizadas a cada iteração (\textit{hopLength});

\item
Na rede neuronal -- tipo de regularização e o parâmetro \textit{lambda} associado, taxa de aprendizagem, método de otimização, número de épocas, número de \textit{batches}, número de camadas na rede e de neurónios em cada camada.

\end{itemize}

Os parâmetros temporais têm influência na estrutura do \textit{dataset} por isso também têm impacto na construção do modelo. Os parâmetros da rede neuronal têm impacto na forma como o modelo se ajusta aos dados recebidos.

O objetivo é escolher os hiper-parâmetros do modelo que produzem os melhores resultados. Para esse efeito, após a verificação dos resultados obtidos no treino e validação, os hiper-parâmetros foram ajustados várias vezes, no sentido de melhorar a qualidade do modelo.

%%________________________________________________________________________
\section{Desenvolvimento da Aplicação \textit{web}}
\label{sec:criacaodaappv2}
%%________________________________________________________________________

Os \textit{clips} constituintes de cada vídeo de teste, bem como todas as informações a eles associadas (eventos em análise, tempos iniciais e finais de cada evento, probabilidade de um evento ser batida de bola, entre outras) foram organizados numa diretoria através de código \textit{Python}. Essa diretoria é posteriormente copiada para a aplicação desenvolvida em PHP. 

A aplicação \textit{web} obtém e processa as informações contidas na diretoria e mostra os resultados ao utilizador. O esquema da figura \ref{fig:webappconstructionprocess} descreve o processo de desenvolvimento da aplicação \textit{web}.

\begin{figure}[h]
   \centering
   \includegraphics[width=12cm]{./web_app_construction_scheme}
\caption{Processo de desenvolvimento da applicação \textit{web}.}
\label{fig:webappconstructionprocess}
\end{figure}

A figura \ref{fig:organizacaodaappweb} representa a estrutura da aplicação.
A diretoria \aspas{\textit{Lib}} contém as constantes, métodos auxiliares (em \aspas{\textit{jsScripts.js}} e \aspas{\textit{styles.css}}) e uma folha de estilos (CSS). A diretoria \aspas{\textit{videos}} recebe outras diretorias que contém informação sobre vídeos classificados. As páginas PHP abaixo permitem apresentar os resultados ao utilizador. 

Do ponto de vista do utilizador, quando este submete as alterações efetuadas na interface apresentada na figura \ref{fig:paginaweb2}, os ficheiros de texto são guardados na pasta \aspas{\textit{userAnalysis}}.

\begin{figure}[h]
   \centering
   \includegraphics[width=5cm]{./app_web_project_sctruture}
\caption{Estrututa do projeto correspondente à aplicação \textit{web} no IDE Netbeans.}
\label{fig:organizacaodaappweb}
\end{figure}


%%________________________________________________________________________
\chapter{Validação e Testes}
\label{ch:validacaoTestes}
%%________________________________________________________________________

Neste capítulo serão apresentados os resultados obtidos ao longo do processo de construção do modelo final a ser utilizado para a classificação de batidas de bola.

%%________________________________________________________________________
\section{Definição dos Hiper-parâmetros}
\label{sec:defhiperparms}
%%________________________________________________________________________

Para obter um modelo que identifique corretamente batidas de bola em raquete foram realizados vários experimentos, alterando os parâmetros da rede neuronal. A tabela \ref{tab:tests_2} contém os resultados obtidos para esses experimentos. Considerou-se um número de \textit{batches} igual a 128, a função de erro \textit{binary cross-entropy}e o algoritmo de optimização \textit{Adam}. Todos os outros hiper-parâmetros encontram-se evidenciados na tabela referida.

A duração dos eventos (\textit{eventLength}) foi pré-definida para meio segundo (0.5 s), por isso, o valor de N (na expressão \ref{eq:formulan}) e o número de exemplos no \textit{dataset} em (\aspas{\textit{Dataset Observations}}) dependem do valor do \textit{hopLength} (\aspas{\textit{Hop}}). Cada um dos experimentos (1 a 18) foi realizado aplicando a técnica \textit{Stratified KFold}, o que permitiu obter 5 modelos diferentes. Os resultados presentes na tabela \ref{tab:tests_2} constituem os valores médios obtidos para modelos construídos. No caso do experimento 1, tem-se o seguinte:

\begin{itemize}
\item 
O \textit{dataset} utilizado foi construído considerando um \textit{hopLength} igual a 1024. A proporção entre batidas de bola e ruído não é igual, uma vez que existem mais exemplos de ruído do que de batidas de bola. 

\item 
Os modelos resultantes da validação cruzada têm 2 camadas escondidas (com 64 e 32 neurónios cada), sobre as quais são apllicadas as técnicas de regularização \textit{dropout} e normas L1 e L2;

\item 
Cada um dos modelos foi treinado ao longo de 100 épocas com o conjunto de treino e testado com o conjunto de validação;

\end{itemize}

O experimento 2 difere do experimento 1 apenas pelo \textit{dataset} que está equilibrado. Os resultados médios de \textit{accuracy} e \textit{loss} destes dois experimentos estão bastante próximos tanto para conjunto de treino como para o conjunto de validação.
Num dos modelos obtidos para o experimento 1, verifica-se uma média harmónica (\textit{f1-score}) de 87\% para a classe dos positivos e 96\% para a classe dos negativos. A taxa de acertos é de 93\% e o erro associado ao processo de aprendizagem é de 21\%. Embora os resultados sejam bons, o desequilíbrio leva a que o modelo classifique com melhor desempenho os exemplos da classes dos negativos. O mesmo acontece para os modelos dos experimentos 4 e 8. 
 
Nos experimentos 3 a 9 (inclusive) procurou-se verificar qual o impacto da ausência da regularização através da norma L1 no desempenho dos modelos. No entanto, não se verificaram diferenças significativas nos resultados (em relação aos outros experimentos).

Nos experimentos 10 a 12 (inclusive) verificou-se que, independentemente do valor de \textit{hopLength}, o uso método \textit{dropout} permite obter resultados tão bons quanto nos casos em que se usam somente as outras técnicas de regularização (L1 ou L2) ou uma combinação das três técnicas.

Os experimentos 13 a 18 foram realizados com o mesmo \textit{dataset}, tendo-se obtido a melhor taxa de acertos para o experimento 17.

%Observando os valores presentes na tabela \ref{tab:tests_2} verifica-se que os valores médios obtidos nas fases de treino e de validação estão bastante próximos. Os valores obtidos para os conjuntos de validação permitem obter uma estimativa de como o classificador se comporta ao observar dados novos. No entanto, os modelos foram treinados e testados com vídeos gravados nas mesmas condições. Para verificar como os modelos se comportam em relação a vídeos gravados em condições diferentes, construíram-se modelos com os mesmos hiper-parâmetros dos experimentos utilizando todos os dados do \textit{dataset}.

Dos experimentos em análise, foi escolhido o experimento 12, uma vez que a rede neuronal correspondente é a mais simples comparando com as restantes e o valor de \textit{hopLength} (4096) implica menos anotações por parte do utilizador. No entanto, o modelo foi treinado e testado com vídeos gravados nas mesmas condições. Para verificar como o modelo se comporta em relação a vídeos gravados em condições diferentes, construiu-se um modelo com os mesmos hiper-parâmetros do experimento 12. De seguida, treinou-se esse modelo utilizando todos os dados do \textit{dataset}.

%=======================================================================
%=======================================================================
%=======================================================================
\begin{table}[p]
\begin{center}

\resizebox{14cm}{!}{% permite fazer


\begin{tabular}{|c|c|c|cc|ccc|c|cccc|}
\hline
\multirow{3}{*}{Experiment} & \multirow{3}{*}{Hop}  & \multirow{3}{*}{Layers} & \multicolumn{2}{c|}{Neurons}                                                                                                                                          & \multicolumn{3}{c|}{Regularization}                                                                                & \multirow{3}{*}{Epochs} & \multicolumn{4}{c|}{Dataset Observations}                                                                                                                          \\ \cline{4-8} \cline{10-13} 
                            &                       &                         & \multicolumn{1}{c|}{\multirow{2}{*}{\begin{tabular}[c]{@{}c@{}}1st \\ Layer\end{tabular}}} & \multirow{2}{*}{\begin{tabular}[c]{@{}c@{}}Hidden\\ Layers\end{tabular}} & \multicolumn{1}{c|}{\multirow{2}{*}{Dropout}} & \multicolumn{1}{c|}{\multirow{2}{*}{L1}}   & \multirow{2}{*}{L2}   &                         & \multicolumn{2}{c|}{Train}                                                                  & \multicolumn{2}{c|}{Validation}                                      \\ \cline{10-13} 
                            &                       &                         & \multicolumn{1}{c|}{}                                                                      &                                                                          & \multicolumn{1}{c|}{}                         & \multicolumn{1}{c|}{}                      &                       &                         & \multicolumn{1}{c|}{Ball Hits}               & \multicolumn{1}{c|}{Noise}                   & \multicolumn{1}{c|}{Ball Hits}              & Noise                  \\ \hline
\multirow{2}{*}{1}          & \multirow{2}{*}{1024} & \multirow{2}{*}{4}      & \multicolumn{1}{c|}{\multirow{2}{*}{66}}                                                   & 64                                                                       & \multicolumn{1}{c|}{0.4}                      & \multicolumn{1}{c|}{\multirow{2}{*}{10-3}} & \multirow{2}{*}{10-3} & \multirow{2}{*}{100}    & \multicolumn{1}{c|}{\multirow{2}{*}{15780}}  & \multicolumn{1}{c|}{\multirow{2}{*}{43716}}  & \multicolumn{1}{c|}{\multirow{2}{*}{3944}}  & \multirow{2}{*}{10930} \\ \cline{5-6}
                            &                       &                         & \multicolumn{1}{c|}{}                                                                      & 32                                                                       & \multicolumn{1}{c|}{0.2}                      & \multicolumn{1}{c|}{}                      &                       &                         & \multicolumn{1}{c|}{}                        & \multicolumn{1}{c|}{}                        & \multicolumn{1}{c|}{}                       &                        \\ \hline
\multirow{2}{*}{2}          & \multirow{2}{*}{1024} & \multirow{2}{*}{4}      & \multicolumn{1}{c|}{\multirow{2}{*}{66}}                                                   & 64                                                                       & \multicolumn{1}{c|}{0.4}                      & \multicolumn{1}{c|}{\multirow{2}{*}{10-3}} & \multirow{2}{*}{10-3} & \multirow{2}{*}{100}    & \multicolumn{1}{c|}{\multirow{2}{*}{12653}}  & \multicolumn{1}{c|}{\multirow{2}{*}{12739}}  & \multicolumn{1}{c|}{\multirow{2}{*}{3163}}  & \multirow{2}{*}{3185}  \\ \cline{5-6}
                            &                       &                         & \multicolumn{1}{c|}{}                                                                      & 32                                                                       & \multicolumn{1}{c|}{0.2}                      & \multicolumn{1}{c|}{}                      &                       &                         & \multicolumn{1}{c|}{}                        & \multicolumn{1}{c|}{}                        & \multicolumn{1}{c|}{}                       &                        \\ \hline
3                           & 2048                  & 3                       & \multicolumn{1}{c|}{33}                                                                    & 256                                                                      & \multicolumn{1}{c|}{0.45}                     & \multicolumn{1}{c|}{N/A}                   & 10-5                  & 100                     & \multicolumn{1}{c|}{6328}                    & \multicolumn{1}{c|}{6367}                    & \multicolumn{1}{c|}{1582}                   & 1592                   \\ \hline
4                           & 2048                  & 3                       & \multicolumn{1}{c|}{33}                                                                    & 256                                                                      & \multicolumn{1}{c|}{0.45}                     & \multicolumn{1}{c|}{N/A}                   & 10-5                  & 300                     & \multicolumn{1}{c|}{7897}                    & \multicolumn{1}{c|}{21863}                   & \multicolumn{1}{c|}{1974}                   & 5466                   \\ \hline
5                           & 2048                  & 3                       & \multicolumn{1}{c|}{33}                                                                    & 256                                                                      & \multicolumn{1}{c|}{0.45}                     & \multicolumn{1}{c|}{N/A}                   & 10-5                  & 300                     & \multicolumn{1}{c|}{6328}                    & \multicolumn{1}{c|}{6367}                    & \multicolumn{1}{c|}{1582}                   & 1592                   \\ \hline
\multirow{2}{*}{6}          & \multirow{2}{*}{4096} & \multirow{2}{*}{4}      & \multicolumn{1}{c|}{\multirow{2}{*}{15}}                                                   & 32                                                                       & \multicolumn{1}{c|}{0.4}                      & \multicolumn{1}{c|}{\multirow{2}{*}{N/A}}  & \multirow{2}{*}{10-5} & \multirow{2}{*}{300}    & \multicolumn{1}{c|}{\multirow{2}{*}{3068}}   & \multicolumn{1}{c|}{\multirow{2}{*}{3213}}   & \multicolumn{1}{c|}{\multirow{2}{*}{767}}   & \multirow{2}{*}{804}   \\ \cline{5-6}
                            &                       &                         & \multicolumn{1}{c|}{}                                                                      & 16                                                                       & \multicolumn{1}{c|}{0.2}                      & \multicolumn{1}{c|}{}                      &                       &                         & \multicolumn{1}{c|}{}                        & \multicolumn{1}{c|}{}                        & \multicolumn{1}{c|}{}                       &                        \\ \hline
7                           & 4096                  & 3                       & \multicolumn{1}{c|}{15}                                                                    & 64                                                                       & \multicolumn{1}{c|}{0.4}                      & \multicolumn{1}{c|}{N/A}                   & 10-4                  & 200                     & \multicolumn{1}{c|}{3068}                    & \multicolumn{1}{c|}{3213}                    & \multicolumn{1}{c|}{767}                    & 804                    \\ \hline
8                           & 4096                  & 3                       & \multicolumn{1}{c|}{15}                                                                    & 64                                                                       & \multicolumn{1}{c|}{0.4}                      & \multicolumn{1}{c|}{N/A}                   & 10-4                  & 200                     & \multicolumn{1}{c|}{11076}                   & \multicolumn{1}{c|}{3828}                    & \multicolumn{1}{c|}{958}                    & 2768                   \\ \hline
9                           & 1024                  & 3                       & \multicolumn{1}{c|}{66}                                                                    & 64                                                                       & \multicolumn{1}{c|}{0.4}                      & \multicolumn{1}{c|}{N/A}                   & 10-6                  & 200                     & \multicolumn{1}{c|}{\multirow{2}{*}{12653}}  & \multicolumn{1}{c|}{\multirow{2}{*}{12739}}  & \multicolumn{1}{c|}{\multirow{2}{*}{3163}}  & \multirow{2}{*}{3185}  \\ \cline{1-9}
10                          & 1024                  & 3                       & \multicolumn{1}{c|}{66}                                                                    & 64                                                                       & \multicolumn{1}{c|}{0.4}                      & \multicolumn{1}{c|}{N/A}                   & N/A                   & 200                     & \multicolumn{1}{c|}{}                        & \multicolumn{1}{c|}{}                        & \multicolumn{1}{c|}{}                       &                        \\ \hline
11                          & 2048                  & 3                       & \multicolumn{1}{c|}{33}                                                                    & 64                                                                       & \multicolumn{1}{c|}{0.4}                      & \multicolumn{1}{c|}{N/A}                   & N/A                   & 200                     & \multicolumn{1}{c|}{6328}                    & \multicolumn{1}{c|}{6367}                    & \multicolumn{1}{c|}{1582}                   & 1592                   \\ \hline
12                          & 4096                  & 3                       & \multicolumn{1}{c|}{15}                                                                    & 64                                                                       & \multicolumn{1}{c|}{0.4}                      & \multicolumn{1}{c|}{N/A}                   & N/A                   & 200                     & \multicolumn{1}{c|}{3068}                    & \multicolumn{1}{c|}{3213}                    & \multicolumn{1}{c|}{767}                    & 804                    \\ \hline
\multirow{2}{*}{13}         & \multirow{2}{*}{1024} & \multirow{2}{*}{4}      & \multicolumn{1}{c|}{\multirow{2}{*}{66}}                                                   & 64                                                                       & \multicolumn{1}{c|}{\multirow{2}{*}{N/A}}     & \multicolumn{1}{c|}{\multirow{2}{*}{10-2}} & \multirow{2}{*}{N/A}  & \multirow{2}{*}{200}    & \multicolumn{1}{c|}{\multirow{10}{*}{12653}} & \multicolumn{1}{c|}{\multirow{10}{*}{12739}} & \multicolumn{1}{c|}{\multirow{10}{*}{3163}} & \multirow{10}{*}{3185} \\ \cline{5-5}
                            &                       &                         & \multicolumn{1}{c|}{}                                                                      & 32                                                                       & \multicolumn{1}{c|}{}                         & \multicolumn{1}{c|}{}                      &                       &                         & \multicolumn{1}{c|}{}                        & \multicolumn{1}{c|}{}                        & \multicolumn{1}{c|}{}                       &                        \\ \cline{1-9}
\multirow{2}{*}{14}         & \multirow{2}{*}{1024} & \multirow{2}{*}{4}      & \multicolumn{1}{c|}{\multirow{2}{*}{66}}                                                   & 64                                                                       & \multicolumn{1}{c|}{\multirow{2}{*}{N/A}}     & \multicolumn{1}{c|}{\multirow{2}{*}{10-4}} & \multirow{2}{*}{N/A}  & \multirow{2}{*}{200}    & \multicolumn{1}{c|}{}                        & \multicolumn{1}{c|}{}                        & \multicolumn{1}{c|}{}                       &                        \\ \cline{5-5}
                            &                       &                         & \multicolumn{1}{c|}{}                                                                      & 32                                                                       & \multicolumn{1}{c|}{}                         & \multicolumn{1}{c|}{}                      &                       &                         & \multicolumn{1}{c|}{}                        & \multicolumn{1}{c|}{}                        & \multicolumn{1}{c|}{}                       &                        \\ \cline{1-9}
15                          & 1024                  & 3                       & \multicolumn{1}{c|}{66}                                                                    & 128                                                                      & \multicolumn{1}{c|}{N/A}                      & \multicolumn{1}{c|}{10-3}                  & 10-3                  & 200                     & \multicolumn{1}{c|}{}                        & \multicolumn{1}{c|}{}                        & \multicolumn{1}{c|}{}                       &                        \\ \cline{1-9}
\multirow{2}{*}{16}         & \multirow{2}{*}{1024} & \multirow{2}{*}{4}      & \multicolumn{1}{c|}{\multirow{2}{*}{66}}                                                   & 32                                                                       & \multicolumn{1}{c|}{\multirow{2}{*}{N/A}}     & \multicolumn{1}{c|}{\multirow{2}{*}{N/A}}  & \multirow{2}{*}{10-5} & \multirow{2}{*}{200}    & \multicolumn{1}{c|}{}                        & \multicolumn{1}{c|}{}                        & \multicolumn{1}{c|}{}                       &                        \\ \cline{5-5}
                            &                       &                         & \multicolumn{1}{c|}{}                                                                      & 32                                                                       & \multicolumn{1}{c|}{}                         & \multicolumn{1}{c|}{}                      &                       &                         & \multicolumn{1}{c|}{}                        & \multicolumn{1}{c|}{}                        & \multicolumn{1}{c|}{}                       &                        \\ \cline{1-9}
\multirow{2}{*}{17}         & \multirow{2}{*}{1024} & \multirow{2}{*}{3}      & \multicolumn{1}{c|}{\multirow{2}{*}{66}}                                                   & 128                                                                      & \multicolumn{1}{c|}{\multirow{2}{*}{N/A}}     & \multicolumn{1}{c|}{\multirow{2}{*}{N/A}}  & \multirow{2}{*}{10-5} & \multirow{2}{*}{200}    & \multicolumn{1}{c|}{}                        & \multicolumn{1}{c|}{}                        & \multicolumn{1}{c|}{}                       &                        \\ \cline{5-5}
                            &                       &                         & \multicolumn{1}{c|}{}                                                                      & 32                                                                       & \multicolumn{1}{c|}{}                         & \multicolumn{1}{c|}{}                      &                       &                         & \multicolumn{1}{c|}{}                        & \multicolumn{1}{c|}{}                        & \multicolumn{1}{c|}{}                       &                        \\ \cline{1-9}
18                          & 1024                  & 3                       & \multicolumn{1}{c|}{66}                                                                    & 64                                                                       & \multicolumn{1}{c|}{N/A}                      & \multicolumn{1}{c|}{N/A}                   & 10-5                  & 200                     & \multicolumn{1}{c|}{}                        & \multicolumn{1}{c|}{}                        & \multicolumn{1}{c|}{}                       &                        \\ \hline
\end{tabular}


}


		
%\caption{Testes realizados.}
\label{tab:tests_1}
		
\end{center}
\end{table}	


%=======================================================================
%=======================================================================
%=======================================================================

\begin{table}[p]
\begin{center}

\resizebox{13cm}{!}{% permite fazer


\begin{tabular}{|c|c|cc|cc|c|}
\hline
\multirow{2}{*}{Experiment} & \multirow{2}{*}{Learning Rate} & \multicolumn{2}{c|}{Accuracy}           & \multicolumn{2}{c|}{Loss}               & \multirow{2}{*}{\begin{tabular}[c]{@{}c@{}}Activation\\ Function\end{tabular}} \\ \cline{3-6}
                            &                                & \multicolumn{1}{c|}{Train} & Validation & \multicolumn{1}{c|}{Train} & Validation &                                                                                \\ \hline
1                           & \multirow{6}{*}{10-3}          & \multicolumn{1}{c|}{92\%}  & 92\%       & \multicolumn{1}{c|}{0.25}  & 0.24       & \multirow{18}{*}{sigmoid}                                                      \\ \cline{1-1} \cline{3-6}
2                           &                                & \multicolumn{1}{c|}{92\%}  & 93\%       & \multicolumn{1}{c|}{0.25}  & 0.23       &                                                                                \\ \cline{1-1} \cline{3-6}
3                           &                                & \multicolumn{1}{c|}{93\%}  & 92\%       & \multicolumn{1}{c|}{0.18}  & 0.21       &                                                                                \\ \cline{1-1} \cline{3-6}
4                           &                                & \multicolumn{1}{c|}{95\%}  & 94\%       & \multicolumn{1}{c|}{0.16}  & 0.18       &                                                                                \\ \cline{1-1} \cline{3-6}
5                           &                                & \multicolumn{1}{c|}{94\%}  & 92\%       & \multicolumn{1}{c|}{0.16}  & 0.22       &                                                                                \\ \cline{1-1} \cline{3-6}
6                           &                                & \multicolumn{1}{c|}{91\%}  & 90\%       & \multicolumn{1}{c|}{0.25}  & 0.26       &                                                                                \\ \cline{1-6}
7                           & \multirow{2}{*}{10-2}          & \multicolumn{1}{c|}{90\%}  & 90\%       & \multicolumn{1}{c|}{0.27}  & 0.28       &                                                                                \\ \cline{1-1} \cline{3-6}
8                           &                                & \multicolumn{1}{c|}{92\%}  & 93\%       & \multicolumn{1}{c|}{0.23}  & 0.22       &                                                                                \\ \cline{1-6}
9                           & 10-4                           & \multicolumn{1}{c|}{93\%}  & 93\%       & \multicolumn{1}{c|}{0.19}  & 0.19       &                                                                                \\ \cline{1-6}
10                          & \multirow{9}{*}{10-3}          & \multicolumn{1}{c|}{94\%}  & 93\%       & \multicolumn{1}{c|}{0.16}  & 0.18       &                                                                                \\ \cline{1-1} \cline{3-6}
11                          &                                & \multicolumn{1}{c|}{93\%}  & 92\%       & \multicolumn{1}{c|}{0.19}  & 0.21       &                                                                                \\ \cline{1-1} \cline{3-6}
12                          &                                & \multicolumn{1}{c|}{91\%}  & 90\%       & \multicolumn{1}{c|}{0.25}  & 0.26       &                                                                                \\ \cline{1-1} \cline{3-6}
13                          &                                & \multicolumn{1}{c|}{89\%}  & 89\%       & \multicolumn{1}{c|}{0.32}  & 0.32       &                                                                                \\ \cline{1-1} \cline{3-6}
14                          &                                & \multicolumn{1}{c|}{94\%}  & 93\%       & \multicolumn{1}{c|}{0.18}  & 0.22       &                                                                                \\ \cline{1-1} \cline{3-6}
15                          &                                & \multicolumn{1}{c|}{95\%}  & 93\%       & \multicolumn{1}{c|}{0.15}  & 0.22       &                                                                                \\ \cline{1-1} \cline{3-6}
16                          &                                & \multicolumn{1}{c|}{95\%}  & 93\%       & \multicolumn{1}{c|}{0.13}  & 0.21       &                                                                                \\ \cline{1-1} \cline{3-6}
17                          &                                & \multicolumn{1}{c|}{97\%}  & 93\%       & \multicolumn{1}{c|}{0.09}  & 0.25       &                                                                                \\ \cline{1-1} \cline{3-6}
18                          &                                & \multicolumn{1}{c|}{96\%}  & 93\%       & \multicolumn{1}{c|}{0.11}  & 0.23       &                                                                                \\ \hline
\end{tabular}

}

		
\caption{Resultados obtidos para os vários hiper-parâmetros da rede neuronal e \textit{datasets} diferentes.}
\label{tab:tests_2}
		
\end{center}
\end{table}	

%=======================================================================
%=======================================================================
%=======================================================================

%%________________________________________________________________________
\section{Classificação de Vídeos Novos}
\label{sec:classifdevideosnovos}
%%________________________________________________________________________


Para verificar a capacidade de generalizar do classificador escolhido, etiquetaram-se mais três vídeos (A, B e C). Estes vídeos (de qualidade profissional) têm durações entre 25 e 45 segundos.

Ao classificar os vídeos referidos acima obtiveram-se os resultados representados na tabela \ref{tab:tests_3}. Estes resultados sugerem que para estes vídeos, o erro associado à classificação é mais alto e a taxa de acertos é mais baixa. Facto que pode ser explicado pela diferença nas condições em que os vídeos foram gravados.

O classificador obteve o menor desempenho para o vídeo B. Observando a a matriz de confusão na figura \ref{fig:videoscm}, verifica-se que este desemepenho se deve ao número elevado de falsos negativos.
O classificador obteve o melhor desempenho para o vídeo A. A matriz de confusão respetiva permite verificar que o classificador consegue identificar corretamente grande parte dos eventos.

\begin{figure}[h]
   \centering
   \includegraphics[width=13cm]{./model_12_test_videos_A_B_C_cm}
\caption{Matrizes de confusão resultantes da classificação dos vídeos A (esquerda), B (meio) e C (direita).}
\label{fig:videoscm}
\end{figure}


\begin{table}[h]
\begin{center}

\resizebox{10cm}{!}{% permite fazer

\begin{tabular}{|ccc|ccc|}
\hline
\multicolumn{3}{|c|}{Test Accuracy}                                    & \multicolumn{3}{c|}{Test Loss}                                        \\ \hline
\multicolumn{1}{|c|}{Video A} & \multicolumn{1}{c|}{Video B} & Video C & \multicolumn{1}{c|}{Video A} & \multicolumn{1}{c|}{Video B} & Video C \\ \hline
\multicolumn{1}{|c|}{81\%}    & \multicolumn{1}{c|}{66\%}    & 0.77    & \multicolumn{1}{c|}{0.42}    & \multicolumn{1}{c|}{1.17}    & 0.53    \\ \hline
\end{tabular}
}
		
\caption{Resultados da classificação sobre vídeos com características diferentes.}
\label{tab:tests_3}
		
\end{center}
\end{table}	

%%________________________________________________________________________
\section{Anotação e Melhoria do \textit{Dataset}}
\label{sec:resultadosnaapp}
%%________________________________________________________________________

Para que o classificador consiga detetar outros \aspas{tipos} de batidas de bola em raquete é necessário alargar o \textit{dataset} adicionando mais exemplos com esses eventos. Para esse efeito, anotou-se o vídeo A através da aplicação \textit{web} desenvolvida. A interface utilizada para realizar a anotação encontra-se na figura \ref{fig:interfacepagina2}. 

\begin{figure}[h]
   \centering
   \includegraphics[width=13cm]{./inteface_page_2}
\caption{Interface da página 2 da aplicação \textit{web}.}
\label{fig:interfacepagina2}
\end{figure}

O ficheiro de texto obtido das alterações submetidas foi utilizado para estender o \textit{dataset} e construir um novo modelo, agora com mais informação para identificar novos tipos de batidas de bola em raquete. 


%%________________________________________________________________________
\chapter{Conclusões e Trabalho Futuro}
\label{ch:conclusoesTrabalhoFuturo}
%%________________________________________________________________________

%%________________________________________________________________________
\section{Conclusões}
\label{sec:conclusoes}
%%________________________________________________________________________

Neste projeto foi desenvolvida uma ferramenta de anotação que permite identificar batidas de bola (em raquete) em jogos de padel. A anotação manual de eventos contitui um processo bastante demorado por isso a aplicação surgiu no sentido de contornar esse problema. 

No processo de construção do \textit{dataset}, a tarefa de criação da janela deslizante permitiu definir vários valores para os saltos que ocorrem a cada iteração no processo de varrimento. Verificou-se também que saltos diferentes produzem \textit{datasets} diferentes, o que permite criar variabilidade no dados utilizados para treinar a rede neuronal.

Os testes realizados variando os hiper-parâmetros na rede neuronal permitiram verificar que os \textit{datasets} desequilibrados levaram à construção de modelos que reconhecem melhor os exemplos da classe dos ruído do que os exemplos da classe da batida de bola. Verificou-se também que a utilização da técnica de regularização \textit{Dropout} é bastante eficaz na redução da complexidade do modelo, permitindo que este generalize com mais facilidade.

A escolha do modelo primou pela simplicidade e pela redução do tempo a ser dispendido pelo utilizador no decurso da anotação automática de eventos.

Este projeto permite concluir que é possível utilizar técnicas de aprendizagem automática na deteção de eventos em jogops de padel.



%%________________________________________________________________________
\section{Trabalho Futuro}
\label{sec:trabalhofuturo}
%%________________________________________________________________________


A aplicação desenvolvida já identifica algumas batidas de bola, mas neste momento o \textit{dataset} está bastante incompleto em termos de variabilidade. Neste sentido, seria bastante vantajoso utilizar a ferramenta para ir aumentando o \textit{dataset} de forma automática.

As caracetrísticas utilizadas para extrair informação do som podem ser revistas, no sentido de se verificar se existem características que permitam distinguir com maior facilidade os eventos em análise.

Relativamente à construção do modelo porderiam ser utilizados outros algoritmos como por exemplo o regressor logístico, que de acordo com a aplicação ODM, também classifica as batidas de bola com alguma robustez.

A adição de outros tipos de eventos, isto é o reconhecimento de outros tipos de eventos ou outros tipos de batidas de bola também poderia contribuir para tornar a aplicação mais rica.  

Espera-se, numa perspetiva futura, que esta aplicação seja útil no reconheimento de batidas de bola.


 


