%%________________________________________________________________________
%% LEIM | PROJETO
%% 2022 / 2013 / 2012
%% Modelo para relatório
%% v04: alteração ADEETC para DEETC; outros ajustes
%% v03: correção de gralhas
%% v02: inclui anexo sobre utilização sistema controlo de versões
%% v01: original
%% PTS / MAR.2022 / MAI.2013 / 23.MAI.2012 (construído)
%%________________________________________________________________________




%%________________________________________________________________________
\chapter{Introdução}
\label{ch:introducao}
%%________________________________________________________________________

A atividade desportiva  de um atleta, numa determinada modalidade, deve ser monitorizada de uma perspetiva externa, no sentido de produzir melhores resultados. Para esse efeito, é necessário que o atleta seja supervisionado durante a sua atividade física, ou que a última seja registada e posteriormente analisada (registo em papel ou em vídeo).

Neste trabalho, a anotação de eventos sonoros em vídeo refere-se ao processo de análise do áudio extraído de um vídeo previamente gravado, com o objetivo de recolher informações relativas a possíveis batidas de bola. O processamento sobre o áudio será realizado em modo \textit{offline}.

Este trabalho destina-se apenas à análise da componente desportiva de padel (\cite{courel2019exploring}), no sentido de fornecer a atletas e/ou treinadores um complemento no decurso do treino. A figura que se segue, corresponde à raquete e bola utilizadas no desporto de padel:

\begin{figure}[h]
   \centering
   \includegraphics[width=2cm]{./padel_court_racket_version}
\caption{Raquete e bola de padel}
\label{fig:raqueteeboladepadel}
\end{figure}

Uma figura com mais detalhe encontra-se disponível no Capítulo \ref{ch:umDetalheAdicional}, na qual se observam as dimensões do campo onde esta modalidade desportiva é realizada. O desporto de padel pode ser praticado em ambiente interior (\textit{indoor}) ou exterior (\textit{outdoor}). No entanto, este trabalho analisa apenas vídeos em ambiente \textit{indoor}.


%%________________________________________________________________________
\section{Motivação}
\label{sec:motivacao}
%%________________________________________________________________________

A aplicação em desenvolvimento implica que se implemente um sistema onde a máquina é capaz de reconhecer batidas de bola. No entanto, a forma como uma máquina reconhece um som difere de como esse mesmo som é percecionado pelo ouvido humano. O ouvido humano consegue fazer a distinção entre sons, considerando as características dos sons emitidos: duração, intensidade, tom, entre outras \cite{national2004hearing}.  Pelo que, é necessário proporcionar à máquina a capacidade de reconhecer batidas de bola de forma semelhante à humana. Para esse efeito, será utilizada a automática. 

A aprendizagem automática permite aplicar algoritmos aos dados recebidos pela máquina, e reconhecer nestes as batidas de bola.

Antes do processo de aprendizagem, não existindo dados relativos aos eventos pretendidos, ou que estejam etiquetados nas condições desejadas, será construído um \textit{dataset} de raiz. Os dados constituintes do \textit{dataset} serão obtidos de vídeos amadores. 

A aplicação em desenvolvimento disponibiliza ainda uma interface, que permite que o utilizador participe no processo de anotação dos eventos (validando os resultados devolvidos pelo classificador), o que poderá contribuir numa perspetiva futura, para aumentar o \textit{dataset} e melhorar deteção de batidas de bola.



%%________________________________________________________________________
\section{Principais Contributos}
\label{sec:principaiscontributos}
%%________________________________________________________________________

Os contributos do sistema em desenvolvimento dividem-se em três componentes: a criação do \textit{dataset}; a construção de um modelo; desenvolvimento de uma plicação \textit{web} que auxilia no processo de aumento do \textit{dataset}. Nesta secção será feita uma descrição geral dessas três componentes.

O processo de construção do \textit{dataset} envolve os seguintes passos:

\begin{itemize}
\item
Extração do áudio a partir do vídeo -- resume-se à conversão do vídeo no áudio correspondente; 

\item
Anotação dos eventos relevantes presentes no áudio -- refere-se à etiquetação de batidas de bola no áudio obtido no ponto anterior; 

\item
Extração das características do áudio -- refere-se à obtenção de padrões no áudio que possam identificar potenciais batidas de bola;

\item
Junção dos dados resultantes dos dois pontos anteriores.
\end{itemize}


O processo de construção do modelo pode ser descrito da seguinte forma:

\begin{itemize}
\item
Escolha do algoritmo de aprendizagem automática -- escolha do algoritmo que melhor se adequa ao reconhecimento de batidas de bola;

\item
Escolha dos hiper-parâmetros que produzem os melhores resultados no treino do modelo;

\item
Aplicação de validação cruzada, no sentido de avaliar o desempenho do modelo em construção, fazendo uso de todo o \textit{dataset} disponível.
\end{itemize}


O desenvolvemento da aplicação \textit{web} envolve a seguinte sequência de passos:

\begin{itemize}
\item
Disponibilizar numa interface, os resultados (em termos de eventos) retornados pelo classificador, evidenciando na série temporal onde ocorrem os eventos correspondentes a batidas de bola;

\item
Nessa mesma interface disponibilizar a opção de validar os eventos considerados pelo modelo como sendo ou não batidas de bola.
\end{itemize}


%%________________________________________________________________________
\section{Validação e Testes}
\label{sec:validacaoetestes}
%%________________________________________________________________________

Validação e testes sobre o classificador: avaliação do classificador (validação cruzada)
Validação e testes sobre a ferramenta final (testes de usabilidade)

Falar um pouco sobre os resultados obtidos em termos de percentagens e a forma como o sistema se comporta face a novos dados de input.

Fazer uma apreciação global dos resultados alcançados (como está no Resumo e Abstract).


%%________________________________________________________________________
\section{Estrutura do Relatório}
\label{sec:estruturadorelatorio}
%%________________________________________________________________________

O relatório está organizado da seguinte forma:

%%(A descrição dos capítulos não precisa de ser muito detalhada. Deve se ser o mais resumida possível.)

\begin{itemize}
\item
O Capítulo 1 introduz a intenção de utilizar a aprendizagem automática para reconhecer padrões identificativos de batidas de bola em treinos de padel. Neste capítulo, são também enunciados os principais contributos da aplicação em desenvolvimento. No final, é realizada uma apreciação global dos resultados obtidos.

\item
O Capítulo 3 descreve e faz referência a trabalhos relacionados com o trabalho corrente. Estes trabalhos foram sendo analisados durante o desenvolvimento do trabalho e baseiam-se também no uso da inteligência artificial para reconhecer eventos em modalidades desportivas.

\item
O Capítulo 4 visa apresentar uma análise geral dos requisitos do sistema e a abordagem considerada para satisfazer esses requisitos.

\item
(Falar do capítulo 5)

\item
(Falar do capítulo 6)

\item
(Falar do capítulo 7)
\end{itemize}



%%________________________________________________________________________
\chapter{Fundamentos}
\label{ch:fundamentos}
%%________________________________________________________________________

Neste capítulo serão abordados os conceitos de carácter teórico, que sustentam o trabalho realizado.


%%________________________________________________________________________
\section{Conceitos de Processamento de Sinal}
\label{sec:processamentodesinal}
%%________________________________________________________________________

Um sinal corresponde a uma grandeza física que varia ao longo do tempo. Em termos matemáticos, um sinal varia em função de uma ou mais variáveis, que podem ser contínuas (sinais contínuos) ou discretas (sinais discretos) \cite{sampaio2006analise}. 

Neste trabalho, será feita uma análise sobre áudio que correspode a um sinal discreto no tempo.


%%________________________________________________________________________
\subsection{Amostragem}
\label{sec:amostragem}
%%________________________________________________________________________

O processo de amostragem converte um sinal contínuo num sinal discreto. Para isso, escolhe pontos equi-espaçados do sinal contínuo para gerar os pontos do sinal discreto \cite{eng_libretexts_sampling}. Cada um dos dos pontos escolhidos é designado por amostra. 

O intervalo entre as amostras consecutivas denomina-se período de amostragem e é dado em segundos(s). O inverso deste valor corresponde à frequência de amostragem, que é dada em \textit{Hertz}(Hz), e refere-se ao número de amostras que ocorre no sinal a cada segundo. A informação removida pelo processo de amostragem pode ser parcialmente recuperada através de interpolação ou reconstrução do sinal \cite{eng_libretexts_reconstruction}. 

O ouvido humano deteta sons na gama de frequências compreendida entre 20Hz e 20kHz, pelo que, de acordo com o teorema  de \textit{Nyquist} \cite{evianyquist}, é necessário que a frequência de amostragem dos sons que chegam ao aparelho auditivo humano sejam amostrados a uma frequencia duas vezes igual ou superior a 20kHz. 

A frequência de amostragem a ser considerada neste projeto é de 44100Hz (cerca de 43kHz), que é um dos valores padrão utilizados \cite{brown2019digital}.


%%________________________________________________________________________
\subsection{Transformada de Fourier}
\label{sec:transformadadefourier}
%%________________________________________________________________________

A transformada de Fourier (\textit{Fourier Transform} -- FT) é uma função matemática que decompõe um sinal nas suas várias frequências (sinusóides) constituintes \cite{SEMMLOW201281}. O sinal de entrada pertence ao domínio do tempo, e o sinal de saída pertence ao domínio da frequência. Esta função (nos domínios do tempo e frequência) é designada por espetro. 

%%Um caso particular da transformada de \textit{Fourier}, é a transformada de \textit{Fourier} a curto prazo (\textit{Short-time Fourier transform} - STFT) que divide o sinal em grupos de amostras sobre os quais aplica a transformada de \textit{Fourier}.

A transformada de \textit{Fourier} é útil para verificar, por exemplo, em que zonas do espetro existe mais ou menos energia concentrada e será utilizada no cálculo das características a extrair do aúdio.


%%________________________________________________________________________
\subsection{Características extraídas do áudio}
\label{sec:caracteristicas}
%%________________________________________________________________________

Neste trabalho, a partir do áudio são extraídas as seguintes características: deteção do início de um som (\textit{Onset}) e o valor eficaz (RMS).

O \textit{Onset} divide-se em duas componentes: a deteção do início (\textit{Onset Detect}) e o fluxo espetral (\textit{Spectral Flux}). A primeira componente, corresponde a detetar o instante em que se inicia um determinado som \cite{rosao2012onset}. A segunda corresponde a verificar variações no espetro do sinal, no sentido de encontrar diferenças entre \textit{frames} consecutivas, o que permite detetar também o início de um som. O fluxo espetral pode também ser definido como uma medida do quão depressa o espetro de um sinal varia \cite{meyda_2022}.

O valor eficaz (\textit{Root Mean Square} -- RMS) refere-se à energia (intensidade) média concentrada numa \textit{frame} \cite{room2021audio}.

A figura \ref{fig:features} constitui uma representação das três características enunciadas.

Observando a figura, verifica-se que os picos das duas componentes do \textit{Onset}, bem como o RMS estão correspondem aos instantes no áudio original onde a amplitude é maior.

\begin{figure}[h]
   \centering
   \includegraphics[width=12cm]{./audio_features}
\caption{Características (cima e meio) e áudio (baixo) correspondente.}
\label{fig:features}
\end{figure}

As características enunciadas acima podem ser calculadas com o auxílio da biblioteca \textit{librosa} \cite{mcfee2015librosa}. Este módulo realiza processamento sobre sinais de áudio, no sentido de recolher informações sobre o mesmo.


%%________________________________________________________________________
\section{Conceitos de Aprendizagem Automática}
\label{sec:aprendizagemauto}
%%________________________________________________________________________

A aprendizagem automática (\textit{Machine Learning} - ML) é ramo da inteligência artificial que recorre à análise de grandes volumes de dados visando extrair padrões e representá-los num modelo \cite{janiesch2021machine}.

Existem três tipos de aprendizagem automática \cite{sah2020machine}:

\begin{itemize}
\item
Supervisionada -- O modelo é construído com base num conjunto de dados (\textit{dataset}) que associa uma lista de características (\textit{features}) à classe correspondente;

\item
Não Supervisionada -- O modelo é construído com base num conjunto de dados (\textit{dataset}) que apenas contém as características;

\item
Por Reforço -- O modelo é contruído com base na interação com um sistema que gera os dados necessários à extração de padrões.

\end{itemize}

Este trabalho utiliza aprendizagem supervisionada para extrair os padrões de áudio (\eg, batida de bola em raquete).


%%________________________________________________________________________
\subsection{\textit{Dataset}}
\label{sec:dataset}
%%________________________________________________________________________

Um \textit{dataset} é um conjunto de dados usado no processo de construção dos modelos gerados através de métodos de aprendizagem automática.
O \textit{dataset} é estruturado em colunas e linhas (formato de tabela). No caso da aprendizagem supervisionada as colunas representam as características (\textit{features}) e a classe. As linhas representam sempre instâncias (exemplos ou observações).

Considerando uma matriz de características, \textit{X}, e o vetor de valores de classes correspondente, \textit{y}, o problema de classificação em questão tem como objetivo obter a função, \textit{f}, tal que:

\begin{equation} 
\label{eq:modelequation}
 f(X)=y
\end{equation}

A função \textit{f} corresponde a um modelo que deve receber a matriz de características e, classificar de maneira correta cada um dos exemplos contituintes.
 

%%________________________________________________________________________
\bigskip
\subsection{Desiquilíbrio no \textit{Dataset}}
\label{sec:desiquilibrionodataset}
%%________________________________________________________________________

O desequilíbrio no \textit{dataset} ocorre quando a distribuição de exemplos pelas classes é desigual \cite{badr2019having}. Esse desequilíbrio pode resultar na construção de um modelo enviesado que reconhece melhor determinadas classes.

Num problema de classificação binária o desequilíbrio pode abordar-se aumentando o número de exemplos da classe em minoria (sobre-amostragem) ou reduzindo o número da classe em maioria (sub-amostragem) \cite{badr2019having}.


%%________________________________________________________________________
\subsection{Hiper-parâmetros}
\label{sec:hiperparametros}
%%________________________________________________________________________

Em aprendizagem automática, um hiper-parâmetro é um valor utilizado pelo modelo para controlar o processo de treino. Os hiper-parâmetros de um modelo não são utilizados diretamente no modelo, mas determinam os parâmetros internos utilizados diretamente \cite{nyuytiymbiy2021parameters}. O prefixo \aspas{hiper} advém do facto de estes parâmetros serem os escolhidos para definir outros, sugerindo que estão num nível hierárquico superior. 


%%________________________________________________________________________
\subsection{Redes Neuronais}
\label{sec:redesneuronais}
%%________________________________________________________________________

Uma rede neuronal artificial (\textit{Artificial Neural Network} -- ANN) é uma técnica de aprendizagem automática que tem como inspiração a biologia humana e a forma como os neurónios comunicam entre si para compreender os dados percecionados \cite{rauberredes}.

%À semelhança do cérebro humano, o neurónio é a unidade básica da rede neuronal. Um neurónio funciona como uma função que recebe um determinado \textit{input}, processa-o e devolve um \textit{output}. No capítulo \ref{ch:outroDetalheAdicional} encontra-se uma figura ilustrativa de um neurónio consituinte de uma rede neuronal.

Uma rede neuronal está organizada em camadas, que são constituídas por unidades (nós). A primeira camada (de\textit{input}), tem um número de nós igual ao número de caracteríticas do \textit{dataset}. A última camada (de \textit{output}), possui um número de nós igual ao número de classes.
Entre a camada de \textit{input} e a camada de \textit{output} existem uma ou mais camadas intermédias. A figura \ref{fig:redeneuronal} representa de uma rede neuronal, onde estão delimitadas as ligações entre os vários nós constituintes:

\begin{figure}[h]
   \centering
   \includegraphics[width=8cm]{./NN}
\caption{Representação típica de uma rede neuronal.}
\label{fig:redeneuronal}
\end{figure}

O número de camadas, bem como o número de nós em cada camada são definidos com o objetivo de obter o melhor classificador possível \cite{krishnandetermine}.

Tal como se verifica na figura \ref{fig:redeneuronal}, cada nó recebe os valores de saída dos nós da camada anterior e associa-lhes um peso que é atualizado ao longo do processo de aprendizagem \cite{medium_2019}. 

O processo de aprendizagem é realizado ao longo de várias épocas. Uma época (\textit{epoch}) corresponde a um ciclo de passagem, pela rede neuronal, de todos os exemplos do \textit{dataset}. Uma época é constituída por várias iterações. Cada iteração corresponde a uma atualização de pesos após a passagem pela rede de um número pré-definido (\textit{batch}) de exemplos.


%%________________________________________________________________________
\subsection{Validação Cruzada}
\label{sec:classifevalidacaocruzada}
%%________________________________________________________________________

No caso da aprendizagem supervisionada, a classificação é utilizada para atribuir uma classe (categoria) a um conjunto de exemplos. Após este processo, é construído um modelo que através dos padrões presentes nos dados de \textit{input}, prevê a classe à qual esses dados pertencem. Existem três tipos de classificação \cite{brownlee4types}:

\begin{itemize}
\item
Multi-Classe -- quando existem mais do que duas classes nos dados. Um exemplo não pode pertencer, simultanemente, a mais do que uma classe.

\item
Binária -- quando existem apenas duas classes nos dados. Um exemplo não pode pertencer, simultanemente, a mais do que uma classe.

\item
Multi-Label -- quando existem existem duas ou mais classes e um exemplo pode pertencer, simultanemente, a mais do que uma classe.

\end{itemize}

Neste trabalho, o problema de classificação é binário, uma vez que o modelo deve distinguir exemplos que são batidas de bola (positivos) de exemplos que não são batidas de bola (negativos).

Para avaliar o desempenho de um classificador é necessário verificar quais são as hipótes de este acertar independentemente da classe, mas também verificar a distribuição de acertos em cada classe. Essas probabilidades podem ser obtidas através da matriz de confusão. Neste trabalho, entre as várias métricas de desempenho que podem ser obtidas da matriz de confusão, serão consideradas as seguintes \cite{brownlee2020tour}:

\begin{itemize}
\item
Taxa de sucesso (\textit{Accuracy}) -- percentagem de exemplos bem classificados independentemente da classe;

\item
Precisão (\textit{Precision}) -- percentagem de exemplos que o classificador indicou serem de uma determinada classe e que pertencem a essa classe;

\item
Cobertura (\textit{Recall}) -- percentagem de exemplos que pertencem a uma determinada classe e o classificador indicou como sendo dessa classe;

\item
\textit{F1-score} -- é a média harmónica entre a precisão e a cobertura.

\end{itemize}

Em geral, num problema de classificação os dados são divididos em treino e teste. O grupo de exemplos de treino é utilizado no processo de aprendizagem, e o  grupo de teste é utilizado no processo de classificação. 

Esta distribuição dos dados pode não ser suficiente para que o modelo aprenda a generalizar, ao analisar dados novos. Como solução, pode ser utilizada validação.

Um caso particular da validação é a técnica de validação cruzada \cite{mohammed_cv_2020}. Esta técnica divide os dados em K grupos (\textit{folds}) e ao longo de K iterações treina K modelos diferentes onde K-1 \textit{folds} são utilizados para treino e um \textit{fold} é utilizado para validação.

Neste trabalho, será utilizada a técnica de validação cruzada estratificada (\textit{Stratified K-Fold}) que permite manter a distribuição dos exemplos de cada classe nos \textit{folds}.


%%________________________________________________________________________
\chapter{Trabalho Relacionado}
\label{ch:trabalhoRelacionado}
%%________________________________________________________________________

Este capítulo faz referência a artigos e outros trabalhos de cariz técnico que se relacionam com o trabalho em desenvolvimento: uso de algoritmos de aprendizagem para reconhecimento de eventos em modalidades desportivas.


No fundo, pegar nos artigos científicos e relacionar/ comparar com o que se pretende no trabalho: tecnologias utilizadas, métodos de desenvolvimento, área a que se aplica (desporto).

Trabalho relacionado aqui \ldots

Aqui terá certamente necessidade de citar (fazer referência) a vários trabalhos anteriormente publicados e que foi analisando ao longo de todo o seu projeto. Esses trabalhos devem ser apresentados com os seguintes objetivos essenciais:
\begin{itemize}
\item
delimitar o contexto onde o seu projeto se insere,

\item
definir claramente os aspetos diferenciadores (inovadores) do seu projeto,

\item
identificar e caracterizar os pressupostos (teóricos ou tecnológicos) em que o projeto se baseia.
\end{itemize}

Cada trabalho a que fizer referência precisa de ser corretamente identificado. Essa identificação depende do tipo de publicação do trabalho. Um trabalho terá sido publicado em revista científica, \eg, \cite{Elzinga_Mills_2011}, outro em ata de conferência internacional, \eg, \cite{Boutilier_et_al_1995}, outro em livro, \eg, \cite{Bellifemine_et_al_2007}, ou apenas em capítulo de livro, \eg, \cite{Wooldridge_2000}, ou pode ainda incluído numa coleção, \eg, \cite{Howard_Matheson_1984} e há também a hipótese de ser uma \aspas{publicação de proveniência diversa}, como no caso em que o \aspas{o sítio na Internet} é a principal forma de publicação, \eg, \cite{Python_2012} e, por fim, a publicação pode ser um relatório técnico, \eg, \cite{Marin_2006}.

Para conseguir lidar de forma adequada com as referências é importante construir um acervo e ter um mecanismo para geração automática (e correta) das referências que vai fazendo ao longo do texto.

Atualmente, as publicações têm também informação sobre o modo como devem ser corretamente citadas; em geral essa informação segue o formato \textsc{Bib}\TeX.

Para fazer referência a um trabalho é necessário seguir as boas regras (sintáticas) para uma citação correta, mas isso não é suficiente; falta a \aspas{semântica}. Ou seja, é também preciso descrever o essencial do trabalho que está a citar. É necessário explicar esse trabalho e enquadrá-lo, no texto, de modo a tornar clara a relação entre esse trabalho e o seu projeto.



%%________________________________________________________________________
\chapter{Modelo Proposto}
\label{ch:modeloProposto}
%%________________________________________________________________________

Neste capítulo será realizada uma descrição geral do sistema desenvolvido, dos requisitos e da abordagem adotada para o desenvolver. 


%%________________________________________________________________________
\section{Descrição Geral do Sistema}
\label{sec:descricaogeral}
%%________________________________________________________________________


O funcionamento do sistema pode ser representado como se mostra na figura \ref{fig:systemscheme}. O sistema desenvolvido reconhece batidas de bola e permite auxiliar no processo de construção do dataset e, consequentemente no processo de melhoria do classificador.

\begin{figure}[h]
   \centering
   \includegraphics[width=12cm]{./system_scheme}
\caption{Sistema de anotação de eventos desejado.}
\label{fig:systemscheme}
\end{figure}


%%________________________________________________________________________
\section{Requisitos}
\label{sec:requisitos}
%%________________________________________________________________________

Os requisitos do sistema podem ser funcionais (funções de sistema) e não funcionais (atributos do sistema). As funções de sistema, referem-se a funcionalidades desempenhadas pelo sistema. Neste projeto, os requisitos funcionais foram organizados em dois grupos:

\begin{itemize}

\item
Construção do \textit{dataset};

\item
Cinstrução do classificador.
\end{itemize} 

A tabela \ref{tab:tabelarequisitosfuncdata} contém os requisitos funcionais que dizem respeito à criação do \textit{dataset}:


\begin{table}[h]
		\begin{center}
		
		
				\begin{tabular}{ | l | p{9cm} | l |}
				\hline
				\textbf{Requisito} & \textbf{Função} & \textbf{Categoria} \\ \hline
				R1.1 & Extrair o áudio do vídeo & Invisível \\ \hline
				R1.2 & Anotar as batidas de bola presentes no áudio (A) & Invisível \\ \hline
				R1.3 & Extrair as caracteristicas do áudio (B) & Invisível \\ \hline
				R1.4 & Combinação dos dois conjuntos A e B & Invisível \\ \hline
				\end{tabular}
				
				
		\caption{Requisitos funcionais do sistema em desenvolvimento para a construção do \textit{dataset}.}
		\label{tab:tabelarequisitosfuncdata}
				
		\end{center}
\end{table}	

A tabela \ref{tab:tabelarequisitosfuncclass} contém os requisitos funcionais que dizem respeito ao processo de classificação:
\begin{table}[h]
		\begin{center}
		
		
				\begin{tabular}{ | l | l | l |}
				\hline
				\textbf{Requisito} & \textbf{Função} & \textbf{Categoria} \\ \hline
				R1.1 & Extrair o áudio do vídeo & Invisível \\ \hline
				R1.2 & Extrair as características do áudio & Invisível \\ \hline
				R1.3 & Aplicar o classificador & Invisível \\ \hline
				R1.4 & Apresentar resultados dos eventos etiquetados & Invisível \\ \hline
				\end{tabular}
				
				
		\caption{Requisitos funcionais respeitantes ao processo de classificação.}
		\label{tab:tabelarequisitosfuncclass}
				
		\end{center}
\end{table}	

Os atributos do sistema descrevem a forma como o sistema deve ser disponibilizado. A tabela \ref{tab:tabelarequisitosnaofunc} representa os atributos do sistema.

\begin{table}[h]
		\begin{center}	
		
				\begin{tabular}{ | l | p{6cm} | l |}
				\hline
				\textbf{Atributo} & \textbf{Detalhe/ Restrição Fronteira} & \textbf{Categoria} \\ \hline
				Interação Homem-Máquina & Detalhe \newline Interface fácil de aprender a usar & Obrigatório \\ \hline
				
				\end{tabular}
								
		\caption{Requisitos não funcionais do sistema.}
		\label{tab:tabelarequisitosnaofunc}
				
		\end{center}
\end{table}	
\clearpage

%%________________________________________________________________________
\section{Abordagem}
\label{sec:abordagem}
%%________________________________________________________________________


Neste secção será descrita a abordagem utilizada para realizar cada uma das etapas inerentes ao sistema em desenvolvimento. As etapas são as seguintes:

\begin{itemize}

\item
Construção do \textit{dataset};

\item
Construção de um classificador que reconhece batidas de bola;

\item
Desenvolvimento de uma aplicação \textit{web} que contribui para aumentar o \textit{dataset}.

\end{itemize} 


%%________________________________________________________________________
\subsection{Construção do \textit{Dataset}}
\label{sec:construcaododataset}
%%________________________________________________________________________

O \textit{dataset} construído, corresponde a um conjunto de dados com padrões identificativos de batidas de bola. 

\paragraph{\textbf{Obtenção da matriz de características -- \textit{X}}} \hspace{0pt}

\smallskip
\smallskip
\smallskip
\noindent No processo de extração das características (enunciadas na secção \ref{sec:caracteristicas}) será realizado um varrimento sobre o áudio com uma janela fixa. Este processo é realizado ao longo de várias iterações, onde em cada iteração a janela desliza um número específico de amostras, a partir das quais são extraídas as características pretendidas. 

No cálculo dessas características, o \textit{package librosa} considera um salto (\aspas{\textit{hop}}) de 512 amostras. Pelo que, este módulo divide o sinal em segmentos, com 512 amostras de dimensão, e sobre cada um deles calcula o valor da característica \cite{mcfee2015librosa}. No entanto, podem ser escolhidos múltiplos do valor do salto como outras abordagens, no sentido de verificar que alterações produzem no desempenho do classificador. O mesmo se aplica ao tamanho da janela: uma batida de bola dura em média meio segundo, mas podem ser realizados experimentos com durações maiores (na tabela \ref{tab:tabelaparamformuladen}). Neste trabalho, como primeira abordagem, será considerada uma janela de 0.5 segundos e um salto de 1024 amostras.

A matriz \textit{X} é constituída por M linhas ou exemplos. Por sua vez, cada exemplo tem N colunas ou valores de características, pelo que a matriz \textit{X} pode ser representada na figura \ref{fig:matrizfeaturesv1} da seguinte forma:


\begin{figure}[h]
\[ 
X = 
 \begin{bmatrix}
  X_{1} & X_{2} & X_{3} & \cdots & X_{N} \\
	X_{2} & X_{3} & X_{4} & \cdots & X_{N+1} \\
	X_{3} & X_{4} & X_{5} & \cdots & X_{N+2} \\
  \vdots  & \vdots  & \vdots  & \ddots & \vdots  \\
  X_{N-1} & X_{N} & X_{N+1} & \cdots & X_{2N-2} \\
	X_{N} & X_{N+1} & X_{N+2} & \cdots & X_{2N-1} \\
	X_{N+1} & X_{N+2} & X_{N+3} & \cdots & X_{2N} \\
	\vdots  & \vdots  & \vdots  &  & \vdots
 \end{bmatrix}
 \]
\caption{Matriz de características.}
\label{fig:matrizfeaturesv1}
\end{figure}


O valor de N na figura \ref{fig:matrizfeaturesv1}, corresponde ao número de segmentos de amostras abranjidos pela janela fixa para uma característica. O valor de \textit{N} pode ser dado pela seguinte expressão:


\begin{equation} 
\label{eq:formulan}
N=\frac{eventLength \times samplingRate}{hopLength}
\end{equation}

onde na equação, \textit{eventLength} corresponde à duração de um evento ou batida de bola, \textit{samplingRate} é a frequência de amostragem (a que os áudios são obtidos), e \textit{hopLength} refere-se ao número de amostras deslizadas a cada iteração do varrimento. Na tabela \ref{tab:tabelaparamformuladen}, estão evidenciados os valores de N obtidos para as várias combinações de \textit{eventLength} e \textit{hopLength}:

\begin{table}[h]
		\begin{center}
				\begin{tabular}{ | c | c | c |} \hline
				\textbf{\textit{eventLength}} & \textbf{\textit{hopLength}} & \textbf{\textit{N}} \\ \hline
						0.5 & 512 & 43 \\ \hline
						0.5 & 1024 & 22 \\ \hline
						0.5 & 2048 & 11 \\ \hline
						0.7 & 512 & 60 \\ \hline
						0.7 & 1024 & 30 \\ \hline
						0.7 & 2048 & 15 \\ \hline
						1.0 & 512 & 86 \\ \hline
						1.0 & 1024 & 43 \\ \hline
						1.0 & 2048 & 22 \\ \hline
				\end{tabular}
				
		\caption{Valores de duração (em segundos), amostras delizadas e N a considerar, para um valor de \textit{samplingRate} igual a 44100Hz.}
		\label{tab:tabelaparamformuladen}
				
		\end{center}
\end{table}	

Voltando ao processo de deslizamento da janela e observando ainda a figura \ref{fig:matrizfeaturesv1}, a primeira iteração permite obter a primeira linha da matriz X. A segunda segunda iteração permite obter a segunda linha da matriz e, assim sucessivamente até à iteração M. Note-se que o valor de N, corresponde ao número de segmentos de amostras obtidos para uma característica. Por isso, caso se pretenda considerar as três características enunciadas na secção \ref{sec:caracteristicas}, o número de elementos em cada linha da matriz \textit{X}, é igual a três vezes o valor de N. 

\bigskip
\paragraph{\textbf{Obtenção do vetor de classes -- \textit{y}}} \hspace{0pt} \\

\noindent Cada um dos exemplos da matriz de características pertence a uma classe ou categoria. O vetor de classes pode ser representado da seguinte forma:

\begin{figure}[h]
\[ 
y = 
 \begin{bmatrix}
  y_{1} \\
	y_{2} \\
	y_{3} \\
  \vdots \\
  y_{M} 
 \end{bmatrix}
 \]
\caption{Vetor de classes.}
\label{fig:matrizclasses}
\end{figure}


onde cada elemento $y_i$ corresponde à classe etiquetada.
Para obtenção deste vetor, é necessário etiquetar manualmente o  áudio. O processo resume-se a ouvir o áudio e anotar num ficheiro .csv, em que intervalos de tempo ocorrem batidas de bolas. 

Note-se que apenas as batidas de bola são registadas no ficheiro. Por isso, todos os eventos que não são registados constituem ruído.
Cada um dos exemplos, $y_i$, do vetor \textit{y} terá um valor dependente da expressão \ref{eq:formulay}:

\begin{equation} 
\label{eq:formulay}
y_{i} = \begin{cases} \text{Ball hit } & \quad \forall X_{i} \text{:} X_{i} \in [\textit{beginSample}, \textit{endSample}] \\ 
									\text{Non ball hit }  & \quad \forall X_{i} \text{:} X_{i} \notin [\textit{beginSample}, \textit{endSample}] \end{cases}
\end{equation}

onde \textit{beginSample} é a amostra inicial do evento e \textit{endSample} corresponde à  amostra final constituinte desse mesmo evento.


\bigskip
\paragraph{\textbf{Criação do \textit{dataset}}} \hspace{0pt} \\

\noindent O processo de construção do \textit{dataset} refere-se à junção da matriz de características ao vetor de classes. A janela desliza ao longo do áudio por isso, um conjunto de exemplos ou instâncias, $X_i$, corresponderão a uma mesma classe, $y_i$, tal como se verifica na figura \ref{fig:matrizfeaturesv2}: 

\begin{figure}[h]
\[ 
X = 
 \begin{bmatrix}
  X_{1} & X_{2} & X_{3} & \cdots & X_{N} & y_{1} \\
	X_{2} & X_{3} & X_{4} & \cdots & X_{N+1} & y_{1} \\
	X_{3} & X_{4} & X_{5} & \cdots & X_{N+2} & y_{1} \\
  \vdots  & \vdots  & \vdots  & \ddots & \vdots  \\
  X_{N-1} & X_{N} & X_{N+1} & \cdots & X_{2N-2} & y_{1} \\
	X_{N} & X_{N+1} & X_{N+2} & \cdots & X_{2N-1} & y_{1} \\
	X_{N+1} & X_{N+2} & X_{N+3} & \cdots & X_{2N} & y_{1} \\
	\vdots  & \vdots  & \vdots  &  & \vdots & \vdots
 \end{bmatrix}
 \]
\caption{Matriz de características.}
\label{fig:matrizfeaturesv2}
\end{figure}

As linhas ou instâncias seguintes, que não estão evidenciadas na matriz, estão associadas a outra classe e, assim sucessivamente.

O vídeo de \textit{input}, a partir do qual o \textit{dataset} foi construído é um vídeo obtido de forma não profissional e tem a duração de 1 hora e 32 minutos. O vídeo em questão constitui uma gravação de um treino realizado por um conjunto de atletas em ambiente \textit{indoor}.


%%________________________________________________________________________
\subsection{Construção do Classificador}
\label{sec:construcaodoclassificador}
%%________________________________________________________________________

Antes de construir o classificador, foi necessário escolher o algoritmo de aprendizagem automática a utilizar. Para esse efeito, fez-se uso da ferramenta \textit{Orange Data Mining} -- ODM que permite simular a aplicação de vários algoritmos aos dados, no sentido de verificar quais destes produzem os melhores resultados \cite{bruno_odm_2019}.

A construção do classificador envolve também a escolha dos hiper-parâmetros que produzem os melhores resultados.

%%________________________________________________________________________
\subsection{Desenvolvimento de uma Aplicação \textit{web}}
\label{sec:criacaodaapp}
%%________________________________________________________________________

A aplicação \textit{web} desenvolvida tem duas páginas: página (1) que permite escolher o vídeo sobre o qual se pretende visualizar os resultados; página (2) que permite visualizar os resultados devolvidos pelo classificador.
O \textit{design} destas páginas encontra-se nas figuras \ref{} e \ref{fig:paginaweb2}. Todo o processamento efetuado sobre o áudio é realizado antes de mostrar os resultados nesta aplicação.

\begin{figure}[h]
   \centering
   \includegraphics[width=12cm]{./mockup_pagina_web_2}
\caption{\textit{Design} desejado da página \textit{web} 2.}
\label{fig:paginaweb2}
\end{figure}



