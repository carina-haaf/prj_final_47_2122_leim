%%________________________________________________________________________
%% LEIM | PROJETO
%% 2022 / 2013 / 2012
%% Modelo para relatório
%% v04: alteração ADEETC para DEETC; outros ajustes
%% v03: correção de gralhas
%% v02: inclui anexo sobre utilização sistema controlo de versões
%% v01: original
%% PTS / MAR.2022 / MAI.2013 / 23.MAI.2012 (construído)
%%________________________________________________________________________




%%________________________________________________________________________
\chapter{Introdução}
\label{ch:introducao}
%%________________________________________________________________________

A atividade desportiva  de um atleta, numa determinada modalidade, deve ser monitorizada de uma perspetiva externa, no sentido de produzir melhores resultados. Para esse efeito, é necessário que o atleta seja supervisionado durante a sua atividade física, ou que o seu treino seja registado (em papel ou vídeo) e posteriormente analisado.

Neste trabalho, a anotação de eventos sonoros em vídeo refere-se à análise do áudio extraído de um vídeo previamente gravado, com o objetivo de identificar cada instante em que ocorre uma batida de bola (tipo ténis) em raquete. O processamento sobre o áudio será realizado em modo \textit{offline}.

Entre os vários desportos praticados, este trabalho foca-se na análise da componente desportiva de padel (\cite{courel2019exploring}), no sentido de fornecer a atletas e/ou treinadores um complemento no decurso do treino. Uma figura referente ao campo onde este desporto é praticado e à raquete e bola utilizadas encontra-se disponível no Capítulo \ref{ch:umDetalheAdicional}, na qual se observam as dimensões do campo onde esta modalidade desportiva é realizada. O desporto de padel pode ser praticado em ambiente interior (\textit{indoor}) ou exterior (\textit{outdoor}). Este trabalho analisa apenas vídeos em ambiente \textit{indoor}.

%%________________________________________________________________________
\section{Motivação}
\label{sec:motivacao}
%%________________________________________________________________________

A aplicação em desenvolvimento implica que se implemente um sistema onde a máquina é capaz de reconhecer batidas de bola. No entanto, a forma como uma máquina reconhece um som difere de como esse mesmo som é percecionado pelo ouvido humano. O ouvido humano consegue fazer a distinção entre sons, considerando as características dos sons emitidos: duração, intensidade, tom, entre outras \cite{national2004hearing}. É necessário proporcionar à máquina a capacidade de reconhecer batidas de bola de forma semelhante à humana. Para esse efeito, será utilizada a aprendizagem automática. 

A aprendizagem automática permite identificar e reconhecer padrões identificativos de batidas de bola no \textit{dataset} fornecido.

A aplicação em desenvolvimento disponibiliza ainda uma interface, que permite que o utilizador participe no processo de anotação dos eventos (validando os resultados devolvidos pelo classificador), o que poderá contribuir numa perspetiva futura, para aumentar o \textit{dataset} e melhorar deteção de batidas de bola.

%%________________________________________________________________________
\section{Principais Contributos}
\label{sec:principaiscontributos}
%%________________________________________________________________________

A realização deste trabalho terá os seguintes contributos:

\begin{itemize}
\item
Não existindo dados relativos a batidas de bola ou que estejam etiquetados nas condições desejadas, será construído um \textit{dataset} de raiz. Os dados constituintes do \textit{dataset} serão obtidos de vídeos amadores;

\item
Providenciar de um modelo que reconhece batidas de bola;

\item
Proporcionar de uma aplicação \textit{web} que permite aumentar o \textit{dataset}.

\end{itemize}


%%________________________________________________________________________
%\section{Validação e Testes}
%\label{sec:validacaoetestes}
%%________________________________________________________________________

%(A alterar depois de fazer o capítulo de validação e testes)

%%Validação e testes sobre o classificador: avaliação do classificador (validação cruzada). Validação e testes sobre a ferramenta final (testes de usabilidade). Falar um pouco sobre os resultados obtidos em termos de percentagens e a forma como o sistema se comporta face a novos dados de input. Fazer uma apreciação global dos resultados alcançados (como está no Resumo e Abstract).


%%________________________________________________________________________
\section{Estrutura do Relatório}
\label{sec:estruturadorelatorio}
%%________________________________________________________________________

O relatório está organizado da seguinte forma:

%%(A descrição dos capítulos não precisa de ser muito detalhada. Deve se ser o mais resumida possível.)

\begin{itemize}
\item
O Capítulo 1 introduz a necessidade do uso da aprendizagem automática para reconhecer batidas de bola em vídeos de treinos de padel, enuncia os principais contributos da aplicação em desenvolvimento, e realiza uma apreciação global dos resultados obtidos.

\item
O Capítulo 2 faz referência a trabalhos relacionados com o trabalho corrente. Estes trabalhos foram sendo analisados durante o desenvolvimento do trabalho e baseiam-se também no uso de técnicas de aprendizagem automática para reconhecer eventos em modalidades desportivas.

\item
O Capítulo 3 introduz alguns conceitos nos quais o trabalho em desenvolvimento se baseia: conceitos sobre processamento de sinal e de aprendizagem automática.

\item
O Capítulo 4 visa apresentar uma análise geral dos requisitos do sistema e a abordagem utilizada para satisfazer esses requisitos.

\item
O Capítulo 5 descreve todo o processo de concretização da solução abordada no capítulo anterior.

\item
(Falar do capítulo 6)

\item
(Falar do capítulo 7)  
\end{itemize}



%%________________________________________________________________________
\chapter{Fundamentos}
\label{ch:fundamentos}
%%________________________________________________________________________

Neste capítulo serão abordados os conceitos de carácter teórico, que sustentam o trabalho realizado.


%%________________________________________________________________________
\section{Conceitos de Processamento de Sinal}
\label{sec:processamentodesinal}
%%________________________________________________________________________

Um sinal corresponde a uma grandeza física que varia ao longo do tempo. Em termos matemáticos, um sinal varia em função de uma ou mais variáveis, que podem ser contínuas (sinais contínuos) ou discretas (sinais discretos) \cite{sampaio2006analise}. 

Neste trabalho, o áudio será extraído do vídeo através de um processo de amostragem e por isso correspode a um sinal discreto no tempo.


%%________________________________________________________________________
\subsection{Amostragem}
\label{sec:amostragem}
%%________________________________________________________________________

O processo de amostragem converte um sinal contínuo num sinal discreto. Para isso, escolhe pontos equi-espaçados do sinal contínuo para gerar os pontos do sinal discreto. A amostragem de um sinal contínuo com um período específico permite obter um sinal discretizado no tempo \cite{eng_libretexts_sampling}. Cada um dos dos pontos resultantes é designado por amostra. 

O intervalo entre as amostras consecutivas denomina-se período de amostragem e é dado em segundos(s). O inverso deste valor corresponde à frequência de amostragem, que é dada em \textit{Hertz}(Hz), e refere-se ao número de amostras que ocorrem no sinal a cada segundo. A informação removida pelo processo de amostragem pode ser parcialmente recuperada através de interpolação ou reconstrução do sinal \cite{eng_libretexts_reconstruction}. 

O ouvido humano deteta sons na gama de frequências compreendida entre 20Hz e 20kHz, pelo que, de acordo com o teorema  de \textit{Nyquist} \cite{evianyquist}, é necessário que a frequência de amostragem dos sons que chegam ao aparelho auditivo humano sejam amostrados a uma frequência duas vezes igual ou superior a 20kHz. 

A frequência de amostragem a ser considerada neste projeto é de 44100Hz (cerca de 43kHz), que é um dos valores padrão utilizados \cite{brown2019digital}.


%%________________________________________________________________________
\subsection{Transformada de Fourier}
\label{sec:transformadadefourier}
%%________________________________________________________________________

A transformada de Fourier (\textit{Fourier Transform} -- FT) é uma função matemática que decompõe um sinal nas suas várias frequências (sinusóides) constituintes \cite{SEMMLOW201281}. O sinal de entrada pertence ao domínio do tempo, e o sinal de saída pertence ao domínio da frequência. Esta função (nos domínios do tempo e frequência) é designada por espetro. 

%%Um caso particular da transformada de \textit{Fourier}, é a transformada de \textit{Fourier} a curto prazo (\textit{Short-time Fourier transform} - STFT) que divide o sinal em grupos de amostras sobre os quais aplica a transformada de \textit{Fourier}.

A transformada de \textit{Fourier} é útil para verificar, por exemplo, em que zonas do espetro existe mais ou menos energia concentrada e será utilizada no cálculo das características a extrair do aúdio.


%%________________________________________________________________________
\subsection{Características extraídas do áudio}
\label{sec:caracteristicas}
%%________________________________________________________________________

Neste trabalho, a partir do áudio são extraídas as seguintes características: deteção do início de um som (\textit{Onset}) e o valor eficaz (RMS).

O \textit{Onset} divide-se em duas componentes: a deteção do início (\textit{Onset Detect}) e o fluxo espetral (\textit{Spectral Flux}). A primeira componente, corresponde a detetar o instante em que se inicia um determinado som \cite{rosao2012onset}. A segunda corresponde a verificar variações no espetro do sinal, no sentido de encontrar diferenças entre \textit{frames} consecutivas, o que permite detetar também o início de um som. O fluxo espetral pode também ser definido como uma medida do quão depressa o espetro de um sinal varia \cite{meyda_2022}.

O valor eficaz (\textit{Root Mean Square} -- RMS) refere-se à energia (intensidade) média concentrada numa \textit{frame} \cite{room2021audio}.

A figura \ref{fig:features} constitui uma representação das três características enunciadas.

Observando a figura, verifica-se que os picos das duas componentes do \textit{Onset}, bem como o RMS correspondem aos instantes no áudio original onde a amplitude é maior.

\begin{figure}[h]
   \centering
   \includegraphics[width=12cm]{./audio_features}
\caption{Características (cima e meio) e áudio (baixo) correspondente.}
\label{fig:features}
\end{figure}

As características enunciadas acima podem ser calculadas com o auxílio da biblioteca \textit{librosa} \cite{mcfee2015librosa}. Este módulo realiza processamento sobre sinais de áudio, no sentido de recolher informações sobre o mesmo.


%%________________________________________________________________________
\section{Conceitos de Aprendizagem Automática}
\label{sec:aprendizagemauto}
%%________________________________________________________________________

A aprendizagem automática (\textit{Machine Learning} - ML) é ramo da inteligência artificial que recorre à análise de (grandes volumes de) dados visando extrair padrões e representá-los num modelo \cite{janiesch2021machine}.

Existem três tipos de aprendizagem automática \cite{sah2020machine}:

\begin{itemize}
\item
Supervisionada -- O modelo é construído com base num conjunto de dados (\textit{dataset}) que associa uma lista de características (\textit{features}) à classe correspondente;

\item
Não Supervisionada -- O modelo é construído com base num conjunto de dados (\textit{dataset}) que apenas contém as características;

\item
Por Reforço -- O modelo é contruído com base na interação com um sistema que gera os dados necessários à extração de padrões.

\end{itemize}

Este trabalho utiliza aprendizagem supervisionada para extrair os padrões de áudio (\eg, batida de bola em raquete).


%%________________________________________________________________________
\subsection{\textit{Dataset}}
\label{sec:dataset}
%%________________________________________________________________________

Um \textit{dataset} é um conjunto de dados usado no processo de construção dos modelos gerados através de métodos de aprendizagem automática.
O \textit{dataset} é estruturado em colunas e linhas (formato de tabela). No caso da aprendizagem supervisionada as colunas representam as características (\textit{features}) e a classe. As linhas representam sempre instâncias (exemplos ou observações).

Considerando uma matriz de características, \textit{X}, e o vetor de valores de classes correspondente, \textit{y}, o problema de classificação em questão tem como objetivo obter a função, \textit{f}, tal que:

\begin{equation} 
\label{eq:modelequation}
 f(X)=y
\end{equation}

A função \textit{f} corresponde a um modelo que deve receber a matriz de características e, classificar de maneira correta cada um dos seus exemplos.
 

%%________________________________________________________________________
\bigskip
\subsection{Desiquilíbrio no \textit{Dataset}}
\label{sec:desiquilibrionodataset}
%%________________________________________________________________________

O desequilíbrio no \textit{dataset} ocorre quando a distribuição de exemplos pelas classes é desigual \cite{badr2019having}. Esse desequilíbrio pode resultar na construção de um modelo enviesado que reconhece melhor determinadas classes.

Num problema de classificação binária o desequilíbrio pode abordar-se aumentando o número de exemplos da classe em minoria (sobre-amostragem) ou reduzindo o número da classe em maioria (sub-amostragem) \cite{badr2019having}. 

Em jogos de padel, o número de batidas de bola é muito inferior ao ruído de fundo, pelo que neste trabalho será utilizada a técnica de sub-amostragem para equilibrar o \textit{dataset}.
 
%%________________________________________________________________________
\subsection{Redes Neuronais}
\label{sec:redesneuronais}
%%________________________________________________________________________

Uma rede neuronal artificial (\textit{Artificial Neural Network} -- ANN) é uma estrutura usada em métodos de aprendizagem automática que tem como inspiração a biologia humana e a forma como os neurónios comunicam entre si para compreender os dados percecionados \cite{rauberredes}.

Uma rede neuronal está organizada em camadas, que são constituídas por unidades (nós). A primeira camada (de \textit{input}), tem um número de nós igual ao número de caracteríticas do \textit{dataset}. A última camada (de \textit{output}), possui os nós que são usados para representar os valores da classe.
Entre a camada de \textit{input} e a camada de \textit{output} existem uma ou mais camadas escondidas. A figura \ref{fig:redeneuronal} representa de uma rede neuronal, onde estão delimitadas as ligações entre os vários nós constituintes.

\begin{figure}[h]
   \centering
   \includegraphics[width=8cm]{./NN}
\caption{Representação típica de uma rede neuronal.}
\label{fig:redeneuronal}
\end{figure}

O número de camadas, bem como o número de nós em cada camada são definidos com o objetivo de obter o melhor classificador possível \cite{krishnandetermine}.

Tal como se verifica na figura \ref{fig:redeneuronal}, cada nó recebe os valores de saída dos nós da camada anterior e associa-lhes um peso que é atualizado ao longo do processo de aprendizagem \cite{medium_2019}. 

Os valores de saída são calculados com base numa fução de ativação que define a forma como os pesos a serem atualizados são calculados numa determinada camada da rede. Neste trabalho serão utilizadas as funções de ativação \cite{brownlee2021choose}:

\begin{itemize}
\item 
ReLU (\textit{Rectified Linear Activation}) -- recebe um valor e devolve outro de acordo com a expressão \ref{eq:formulaReLU}. Pelo que valores negativos são mapeados no valor 0. Esta função será utilizada nas camadas escondidas.

\begin{equation} 
\label{eq:formulaReLU}
\textit{outputValue}=\max{(0, \textit{inputValue})}
\end{equation}

\item 
Sigmóide (\textit{Sigmoid}) -- recebe um valor e devolve outro no intervalo [0, 1] de acordo com a expressão \ref{eq:formulaSigmoid}. Esta função será utilizada na camada de \textit{output}.

\begin{equation} 
\label{eq:formulaSigmoid}
outputValue=\frac{1}{1 + e^{-inputValue}}
\end{equation}

\end{itemize}

O processo de aprendizagem é realizado ao longo de várias épocas. Uma época (\textit{epoch}) corresponde a um ciclo de passagem, pela rede neuronal, de todos os exemplos do \textit{dataset}. Uma época é constituída por várias iterações. Cada iteração corresponde a uma atualização de pesos após a passagem pela rede de um número pré-definido (\textit{batch}) de exemplos. Um valor de \textit{batch} igual a uma potência de 2 acelera o processo de treino \cite{interviewarea_batchsize_2022}.

O uso de métodos de otimização permite atualizar os pesos e a taxa de aprendizagem da rede neuronal de forma a reduzir o erro associado e aumentar a taxa de sucesso. Neste trabalho, será utilizado o método de otimização \textit{Adam} \cite{doshi2019various}.


%%________________________________________________________________________
\subsection{Hiper-parâmetros}
\label{sec:hiperparametros}
%%________________________________________________________________________

Em aprendizagem automática, um hiper-parâmetro é um valor utilizado pelo modelo para controlar o processo de treino. Os hiper-parâmetros de um modelo não são utilizados diretamente no modelo, mas determinam os parâmetros internos utilizados diretamente. O prefixo \aspas{hiper} advém do facto de estes parâmetros serem os escolhidos para definir outros, sugerindo que estão num nível hierárquico superior \cite{nyuytiymbiy2021parameters}.

%%________________________________________________________________________
\subsection{Sobre-aprendizagem}
\label{sec:sobreaprendizagem}
%%________________________________________________________________________

A sobre-aprendizagem (ou \textit{overfitting}) ocorre quando um modelo se ajusta excessivamente aos dados utilizados para treino. Este ajuste faz com que o modelo produza bons resultados no processo de aprendizagem (conjunto de treino), e apresente um mau desempenho quando avalia dados novos (conjunto de teste). 
A sobre-aprendizagem contribui neste sentido para diminuir o desempenho do modelo, pois diminui a capacidade deste de generalizar, isto é classificar corretamente dados nunca antes vistos.

Entre as várias formas de abordar este problema, neste trabalho serão utilizadas as seguintes técnicas:

\begin{itemize}
\item
Simplificação do modelo -- consiste em reduzir a complexidade do modelo. Este processo pode ser realizado reduzindo a quantidade de características. No caso das redes neuronais corresponde a reduzir o número de camadas ou de neurónios em cada camada. 

\item
Regularização -- permite eliminar a informação que  reduz o desempenho do modelo. Neste trabalho serão considerados três tipos de regularização: \textit{Dropout}, \textit{Lasso} e \textit{Ridge}. No método de \textit{Dropout}, a cada iteração do processo de aprendizagem um número (aletório) de neurónios é desativado \cite{medium_2020}. As regularizações de \textit{Lasso} (ou norma L1) e \textit{Ridge} (ou norma L2) penalizam os pesos associados a certas características. A norma L1 coloca os pesos a zero e a norma L2 diminui os valores dos pesos, evitando que o modelo considere que  certas \textit{features} são mais importantes em relação a outras \cite{builtin_2021}. 
 
\end{itemize}

%%________________________________________________________________________
\subsection{Validação Cruzada}
\label{sec:classifevalidacaocruzada}
%%________________________________________________________________________

No caso da aprendizagem supervisionada, a classificação é utilizada para atribuir uma classe (categoria) a um conjunto de exemplos. Após este processo, é construído um modelo que através dos padrões presentes nos dados de \textit{input}, prevê a classe à qual esses dados pertencem. Existem três tipos de classificação \cite{brownlee4types}:

\begin{itemize}
\item
Multi-Classe -- quando existem mais do que duas classes nos dados. Um exemplo não pode pertencer, simultanemente, a mais do que uma classe.

\item
Binária -- quando existem apenas duas classes nos dados. Um exemplo não pode pertencer, simultanemente, a mais do que uma classe.

\item
Multi-Label -- quando existem existem duas ou mais classes e um exemplo pode pertencer, simultanemente, a mais do que uma classe.

\end{itemize}

Neste trabalho, o problema de classificação é binário, uma vez que o modelo deve distinguir exemplos que são batidas de bola em raquete (positivos) de exemplos que não são batidas de bola (negativos).

Para avaliar o desempenho de um classificador é necessário verificar quais são as hipótes de este acertar independentemente da classe, mas também verificar a distribuição de acertos em cada classe. Essas probabilidades podem ser obtidas através da matriz de confusão. Neste trabalho, entre as várias métricas de desempenho que podem ser obtidas da matriz de confusão, serão consideradas as seguintes \cite{brownlee2020tour}:

\begin{itemize}
\item
Taxa de sucesso (\textit{Accuracy}) -- percentagem de exemplos bem classificados independentemente da classe;

\item
Precisão (\textit{Precision}) -- percentagem de exemplos que o classificador indicou serem de uma determinada classe e que pertencem a essa classe;

\item
Cobertura (\textit{Recall}) -- percentagem de exemplos que pertencem a uma determinada classe e o classificador indicou como sendo dessa classe;

\item
\textit{F1-score} -- corresponde à média harmónica entre a precisão e a cobertura \cite{ml_harmonic_score_2017}.

\end{itemize}

Em geral, num problema de classificação os dados são divididos em treino e teste. O grupo de exemplos de treino é utilizado no processo de aprendizagem, e o  grupo de teste é utilizado no processo de classificação. Embora esta abordagem permita verificar como o classificador se comporta na predição sobre dados novos, tem como desvantagem a hipótese de existirem exemplos mais fáceis de identificar no conjunto de teste. Como resultado, o desempenho do modelo obtido pode não corresponder à realidade. Para contornar este problema pode ser a utilizado o método de validação cruzada.

A validação cruzada é uma técnica que permite avaliar a capacidade de generalização de um classificador. Os dados são divididos em K partições (\textit{folds}) e ao longo de K iterações são treinados modelos diferentes, onde K-1 \text it{folds} são utilizados para treino e um \textit{fold} é utilizado para validação \cite{mohammed_cv_2020}.

Dividir os dados em várias partições pode não ser suficiente, uma vez que a distribuição dos exemplos de cada classe pelos \textit{folds} pode não ser igual à original.

De forma a manter essa distribuição de exemplos de cada classe nos \textit{folds} será utilizada a técnica de validação, partição estratificada (\textit{Stratified K-Fold}) \cite{muralidhar2021stratified}.

%%________________________________________________________________________
\chapter{Trabalho Relacionado}
\label{ch:trabalhoRelacionado}
%%________________________________________________________________________

Este capítulo descreve trabalhos relacionados com o tema deste projeto que consiste no uso de aprendizagem automática na deteção de eventos.


%%________________________________________________________________________
\section{Anotação de eventos}
\label{sec:anotacaoeventos}
%%________________________________________________________________________


O sistema desenvolvido em \cite{baughman2019detection}, foca-se na componente acústica para fazer a distinção entre 6 tipos de eventos em jogos de ténis através de uma rede neuronal  convulocional (CNN). O sistema proporciona ainda uma ferramenta que permite realizar a anotação de eventos, aumentar o \textit{dataset} e melhorar a qualidade do modelo. 

Para poupar tempo no processo de anotação e etiquetação, o sistema proposto em \cite{kim2018human} faz o reconhecimento (em áudio) de eventos semelhantes a um evento fornecido pelo utilizador. Este evento fornecido pode ser uma região do áudio selecionada pelo utilizador. O áudio é dividido em pequenos segmentos do mesmo tamanho que o evento que se pretende identificar. O sistema seleciona os segmentos que possuem as características que se aproximam mais do evento em análise e mostra os resultados através de uma interface. O utilizador pode validar e realizar ajustes nos resultados obtidos, o que contribui para melhorar o processo de classificação do modelo utilizado. 

O sistema apresentado em \cite{liu2006multimodal} realiza a deteção de eventos combinando informação visual e acústica obtida em vídeos de basquetebol. A componente acústica foca-se nos eventos que poderão ser indicadores dos momentos mais importantes no jogo, como o som emitido pelos espetadores ou o entuasiasmo na voz de um comentador.

%%________________________________________________________________________
\section{Extração de Características e Reconhecimento de Padrões}
\label{sec:caracteristicasepadroes}
%%________________________________________________________________________

Ainda no sistema apresentado em \cite{baughman2019detection}, o sinal de áudio é dividido em \textit{frames} de 20 milissegundos a partir das quais se obtém os coeficientes de MFCC para reconhecer os eventos de forma semelhante à humana. O sistema proposto em \cite{liu2006multimodal} considera também o nível de energia associado aos segmentos no processo de construção dos vetores de características.

O sistema descrito em \cite{ganser2021classification} permite recolher informação relativa a batidas de bola na atividade desportiva de ténis através de sensores em pulseiras eletrónicas e uma câmara de vídeo. A pulseira grava cerca de 11 sinais, incluindo a unidade de medida de inercial (IMU). No processo de etiquetação a informação obtida em vídeo é sincronizada e combinada com os sinais gravados na pulseira eletrónica para construir o \textit{dataset}. O processo de classificação é realizado através das CNNs.


%%________________________________________________________________________
\chapter{Modelo Proposto}
\label{ch:modeloProposto}
%%________________________________________________________________________

Neste capítulo será realizada uma descrição geral do sistema desenvolvido, dos requisitos e da abordagem adotada para o desenvolver. 

%%________________________________________________________________________
\section{Descrição Geral do Sistema}
\label{sec:descricaogeral}
%%________________________________________________________________________

O sistema desenvolvido reconhece batidas de bola, permite auxiliar no processo de construção do \textit{dataset} e, consequentemente no processo de melhoria de desempenho do classificador. O funcionamento do sistema pode ser representado como se mostra na figura \ref{fig:systemscheme}.

\begin{figure}[h]
   \centering
   \includegraphics[width=12cm]{./system_scheme}
\caption{Sistema de anotação de eventos desejado.}
\label{fig:systemscheme}
\end{figure}


%%________________________________________________________________________
\section{Requisitos}
\label{sec:requisitos}
%%________________________________________________________________________

Os requisitos do sistema podem ser categorizados como funcionais (funções de sistema) e não funcionais (atributos do sistema). As funções de sistema, referem-se a funcionalidades desempenhadas pelo sistema. Os atributos do sistema descrevem a forma como o sistema deve ser disponibilizado.

Neste projeto, os requisitos funcionais foram organizados em dois grupos:

\begin{itemize}

\item
Construção do \textit{dataset};

\item
Construção do classificador.
\end{itemize} 

A tabela \ref{tab:tabelarequisitosfuncdata} contém os requisitos funcionais que dizem respeito à criação do \textit{dataset}:

\begin{table}[h]
		\begin{center}
		
		
				\begin{tabular}{ | l | p{9cm} |}
				\hline
				\textbf{Requisito} & \textbf{Função} \\ \hline
				R1.1 & Extrair o áudio do vídeo \\ \hline
				R1.2 & Anotar as batidas de bola presentes no áudio (A) \\ \hline
				R1.3 & Extrair as caracteristicas do áudio (B) \\ \hline
				R1.4 & Combinação dos dois conjuntos A e B \\ \hline
				\end{tabular}
				
				
		\caption{Requisitos funcionais do sistema em desenvolvimento para a construção do \textit{dataset}.}
		\label{tab:tabelarequisitosfuncdata}
				
		\end{center}
\end{table}	

A tabela \ref{tab:tabelarequisitosfuncclass} contém os requisitos funcionais que dizem respeito ao processo de classificação:
\begin{table}[h]
		\begin{center}
		
		
				\begin{tabular}{ | l | l |}
				\hline
				\textbf{Requisito} & \textbf{Função} \\ \hline
				R1.1 & Extrair o áudio do vídeo \\ \hline
				R1.2 & Extrair as características do áudio \\ \hline
				R1.3 & Aplicar o classificador \\ \hline
				R1.4 & Apresentar resultados dos eventos etiquetados \\ \hline
				\end{tabular}
				
				
		\caption{Requisitos funcionais respeitantes ao processo de classificação.}
		\label{tab:tabelarequisitosfuncclass}
				
		\end{center}
\end{table}	

A tabela \ref{tab:tabelarequisitosnaofunc} representa os atributos do sistema.

\begin{table}[h]
		\begin{center}	
		
				\begin{tabular}{ | l | p{6cm} |}
				\hline
				\textbf{Atributo} & \textbf{Detalhe/ Restrição Fronteira} \\ \hline
				Interação Homem-Máquina & Detalhe \newline Interface fácil de aprender a usar \\ \hline
				
				\end{tabular}
								
		\caption{Requisitos não funcionais do sistema.}
		\label{tab:tabelarequisitosnaofunc}
				
		\end{center}
\end{table}	
\clearpage

%%________________________________________________________________________
\section{Abordagem}
\label{sec:abordagem}
%%________________________________________________________________________

Nesta secção será descrita a abordagem utilizada para realizar cada uma das etapas inerentes ao sistema em desenvolvimento. As etapas são as seguintes:

\begin{itemize}

\item
Construção do \textit{dataset};

\item
Construção de um classificador que reconhece batidas de bola;

\item
Desenvolvimento de uma aplicação \textit{web} que contribui para aumentar o \textit{dataset}.

\end{itemize} 


%%________________________________________________________________________
\subsection{Construção do \textit{Dataset}}
\label{sec:construcaododataset}
%%________________________________________________________________________

O \textit{dataset} construído corresponde a um conjunto de dados com padrões identificativos de batidas de bola. 

\paragraph{\textbf{Obtenção da matriz de características -- \textit{X}}} \hspace{0pt}

\smallskip
\smallskip
\smallskip
\noindent O impacto de uma batida de bola tem uma duração média de 0.5 segundos. Por isso, no processo de extração das características (\cf, \ref{sec:caracteristicas}) é realizado um varrimento sobre o áudio com uma janela temporal de dimensão fixa igual a meio segundo. Este processo é realizado ao longo de várias iterações, onde em cada iteração a janela desliza um número específico de amostras e as amostras abranjidas pela janela são utilizadas para o cálculo das características pretendidas. 

O número de amostras a deslizar ou o salto (\aspas{\textit{hop}}) considerado será de 1024 amostras como primeira abordagem. No entanto, podem ser escolhidos múltiplos deste valor como outras abordagens, no sentido de verificar que alterações produzem no desempenho do classificador (tabela \ref{tab:tabelaparamformuladen}).

A matriz \textit{X} é constituída por M linhas ou exemplos. Por sua vez, cada exemplo tem N colunas ou valores de características, pelo que a matriz \textit{X} pode ser representada na figura \ref{fig:matrizfeaturesv1}.

O valor de N na figura \ref{fig:matrizfeaturesv1}, corresponde ao número de segmentos de amostras abranjidos pela janela fixa para uma característica e pode ser dado pela seguinte expressão:

\begin{equation}
\label{eq:formulan}
N=\frac{eventLength \times samplingRate}{hopLength}
\end{equation}

onde na equação, \textit{eventLength} é a duração de um evento, \textit{samplingRate} é a frequência de amostragem (a que os áudios são obtidos), e \textit{hopLength} refere-se ao número de amostras deslizadas a cada iteração do varrimento. 

\begin{figure}[h]
\[ 
X = 
 \begin{bmatrix}
  X_{1} & X_{2} & X_{3} & \cdots & X_{N} \\
	X_{2} & X_{3} & X_{4} & \cdots & X_{N+1} \\
	X_{3} & X_{4} & X_{5} & \cdots & X_{N+2} \\
  \vdots  & \vdots  & \vdots  & \ddots & \vdots  \\
  X_{N-1} & X_{N} & X_{N+1} & \cdots & X_{2N-2} \\
	X_{N} & X_{N+1} & X_{N+2} & \cdots & X_{2N-1} \\
	X_{N+1} & X_{N+2} & X_{N+3} & \cdots & X_{2N} \\
	\vdots  & \vdots  & \vdots  &  & \vdots
 \end{bmatrix}
 \]
\caption{Matriz de características.}
\label{fig:matrizfeaturesv1}
\end{figure}

Na tabela \ref{tab:tabelaparamformuladen}, estão evidenciados os valores de N obtidos para as várias combinações de \textit{eventLength} e \textit{hopLength}:

\begin{table}[h]
		\begin{center}
				\begin{tabular}{ | c | c | c |} \hline
				\textbf{\textit{eventLength}} & \textbf{\textit{hopLength}} & \textbf{\textit{N}} \\ \hline
						0.5 & 1024 & 22 \\ \hline
						0.5 & 2048 & 11 \\ \hline
						0.5 & 4096 & 5 \\ \hline
				\end{tabular}
				
		\caption{Valores de duração (em segundos), amostras delizadas e N a considerar, para um valor de \textit{samplingRate} igual a 44100Hz.}
		\label{tab:tabelaparamformuladen}
				
		\end{center}
\end{table}	

Observando ainda a figura \ref{fig:matrizfeaturesv1}, a primeira iteração do processo de varrimento permite obter a primeira linha da matriz X. A segunda segunda iteração permite obter a segunda linha da matriz e, assim sucessivamente até à iteração M. Note-se que o valor de N, corresponde ao número de segmentos de amostras obtidos para uma característica. Por isso, caso se pretenda considerar as três características enunciadas na secção \ref{sec:caracteristicas}, o número de elementos em cada linha da matriz \textit{X}, é igual a três vezes o valor de N. 

\smallskip
\paragraph{\textbf{Obtenção do vetor de classes -- \textit{y}}} \hspace{0pt} \\

\noindent Cada um dos exemplos da matriz de características pertence a uma classe ou categoria. O vetor de classes pode ser representado como se mostra na figura \ref{fig:matrizclasses}, onde cada elemento $y_i$ corresponde à classe etiquetada.
Para obtenção deste vetor, é necessário etiquetar manualmente o  áudio. O processo resume-se a ouvir o áudio e anotar num ficheiro (formato.csv), em que intervalos de tempo ocorrem batidas de bolas.

\begin{figure}[h]
\[ 
y = 
 \begin{bmatrix}
  y_{1} \\
	y_{2} \\
	y_{3} \\
  \vdots \\
  y_{M} 
 \end{bmatrix}
 \]
\caption{Vetor de classes.}
\label{fig:matrizclasses}
\end{figure} 

Note-se que apenas as batidas de bola são registadas no ficheiro. Por isso, todos os eventos que não são registados constituem ruído.
Cada um dos exemplos, $y_i$, do vetor \textit{y} terá um valor dependente da expressão \ref{eq:formulay}:

\begin{equation} 
\label{eq:formulay}
y_{i} = \begin{cases} \text{ball-hit } & \quad \forall X_{i} \text{:} X_{i} \in [\textit{beginSample}, \textit{endSample}] \\ 
									\text{noise }  & \quad \forall X_{i} \text{:} X_{i} \notin [\textit{beginSample}, \textit{endSample}] \end{cases}
\end{equation}

onde [\textit{beginSample}, \textit{endSample}] é o intervalo de tempo em que a batida de bola ocorre.

%%onde \textit{beginSample} é a amostra inicial do evento e \textit{endSample} corresponde à  amostra final constituinte desse mesmo evento.

\paragraph{\textbf{Criação do \textit{dataset}}} \hspace{0pt} \\

\noindent O processo de construção do \textit{dataset} refere-se à junção da matriz de características ao vetor de classes. A janela desliza ao longo do áudio por isso, um conjunto de exemplos ou instâncias, $X_i$, corresponderão a uma classe, $y_i$, tal como se verifica na figura \ref{fig:matrizfeaturesv2}.

\begin{figure}[h]
\[ 
X = 
 \begin{bmatrix}
  X_{1} & X_{2} & X_{3} & \cdots & X_{N} & y_{1} \\
	X_{2} & X_{3} & X_{4} & \cdots & X_{N+1} & y_{2} \\
	X_{3} & X_{4} & X_{5} & \cdots & X_{N+2} & y_{3} \\
  \vdots  & \vdots  & \vdots  & \ddots & \vdots  \\
  X_{N-1} & X_{N} & X_{N+1} & \cdots & X_{2N-2} & y_{N-1} \\
	X_{N} & X_{N+1} & X_{N+2} & \cdots & X_{2N-1} & y_{N} \\
	X_{N+1} & X_{N+2} & X_{N+3} & \cdots & X_{2N} & y_{N+1} \\
	\vdots  & \vdots  & \vdots  &  & \vdots & \vdots
 \end{bmatrix}
 \]
\caption{Matriz de características.}
\label{fig:matrizfeaturesv2}
\end{figure}

%%As linhas ou instâncias seguintes, que não estão evidenciadas na matriz, estão associadas a outra classe e, assim sucessivamente.

O vídeo de \textit{input}, a partir do qual o \textit{dataset} foi construído é um vídeo obtido de forma não profissional com uma duração de 1 hora e 32 minutos. e constitui uma gravação de um treino realizado por um conjunto de atletas em ambiente \textit{indoor}.

\bigskip
%%________________________________________________________________________
\subsection{Construção do Classificador}
\label{sec:construcaodoclassificadorv1}
%%________________________________________________________________________

A escolha do algoritmo de aprendizagem automática a utilizar foi realizada através da ferramenta \textit{Orange Data Mining} -- ODM. Esta ferramenta permite  aplicar vários algoritmos aos dados, no sentido de verificar quais destes produzem os melhores resultados \cite{bruno_odm_2019}. Para verificar a qualidade dos modelos é utilizada a técnica partição estratificada ({\textit{Stratified KFold}}) onde os dados são divididos em 5 \textit{folds}.

A construção do classificador envolve também a escolha dos hiper-parâmetros que produzem os melhores resultados.


%%________________________________________________________________________
\subsection{Desenvolvimento da Aplicação \textit{Web}}
\label{sec:criacaodaapp}
%%________________________________________________________________________

Esta sub-secção faz uma descrição da arquitetura e o \textit{design} da aplicação que deve mostrar os resultados obtidos pelo classificador.

\paragraph{\textbf{Arquitetura da Aplicação \textit{Web}}} \hspace{0pt} \\

\noindent
A aplicação divide-se em três componentes: cliente, servidor e dados. A estrutura da aplicação \textit{web} encontra-se na figura \ref{fig:webapparchitecture}. Estas componentes serão todas integradas na mesma máquina para efeitos de simplificação.

A aplicação em desenvolvimento faz uso da linguagem PHP. Esta linguagem é executada no lado do servidor e permite criar interação com o utilizador através de páginas HTML dinâmicas. No lado do cliente será utilizada a linguagem \textit{Javascript} e AJAX através dos quais serão utilizados os métodos GET e POST para receber ou enviar dados para o servidor \cite{w3schools_ajax_2022}.  

\begin{figure}[h]
   \centering
   \includegraphics[width=12cm]{./app_structure}
\caption{Estrutura da aplicação \textit{web}.}
\label{fig:webapparchitecture}
\end{figure}


\paragraph{\textbf{\textit{Design} da Aplicação}} \hspace{0pt} \\

\noindent 
A aplicação \textit{web} desenvolvida tem duas páginas: página (1) que permite escolher o vídeo sobre o qual se pretende visualizar os resultados; página (2) que permite visualizar os resultados devolvidos pelo classificador (para um determinado vídeo).
O \textit{design} destas páginas encontra-se nas figuras \ref{fig:paginaweb1} e \ref{fig:paginaweb2}. Todo o processamento efetuado sobre o áudio é realizado antes de apresentar os resultados nesta aplicação.

Para simplificar, a página 1 terá um lista de vídeos que já foram classificados. Ao selecionar um vídeo é redirecionado para a página 2, que permite analisar os vários \textit{clips} constituintes do vídeo selecionado. 


\begin{figure}[h]
   \centering
   \includegraphics[width=11cm]{./mockup_pagina_web_1}
\caption{\textit{Design} desejado da página \textit{web} 1.}
\label{fig:paginaweb1}
\end{figure}

Os clips são resultado do processo de deslizamento da janela ao longo do vídeo (de teste) a classificar. Desta forma, cada \textit{clip} tem a duração de 0.5 segundos.
Através do botão \aspas{\textit{select}} é possível selecionar um \textit{clip} (à esquerda) e visualizá-lo (à direita).
Ainda na página 2 o utilizador pode validar os resultados devolvidos pelo classificador alterando o tipo de evento (entre \aspas{\textit{ball-hit}} e \aspas{\textit{noise}}) na primeira coluna. É ainda possível ordenar e visualizar os eventos por probabilidade de serem batida de bola (na ordem decrescente).

\begin{figure}[h]
   \centering
   \includegraphics[width=14cm]{./mockup_pagina_web}
\caption{\textit{Design} desejado da página \textit{web} 2.}
\label{fig:paginaweb2}
\end{figure}

